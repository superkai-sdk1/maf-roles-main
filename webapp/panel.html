<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Maf roles control panel</title>
    <script>
        // Cache-busting: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.__v = Date.now();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram WebApp
        window.addEventListener('error', (e) => {
            if (e.filename && e.filename.includes('telegram-web-app.js')) {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ Telegram WebApp —Å–∫—Ä–∏–ø—Ç–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è):', e.message);
                e.preventDefault();
            }
        });
    </script>
    <script src="https://telegram.org/js/telegram-web-app.js" onerror="console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram WebApp —Å–∫—Ä–∏–ø—Ç')"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script>
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö CSS —Å cache-busting
        [
            '../assets/font-akrobat/css.css',
            '../assets/flex.css',
            './styles-panel.css',
            './login/auth.css'
        ].forEach(function(href) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href + '?v=' + window.__v;
            document.head.appendChild(link);
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/7.2.96/css/materialdesignicons.min.css">
    
    <!-- –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∑—É–º–∞ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ Telegram Mini Apps -->
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å box-sizing –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ */
        *, *:before, *:after {
            box-sizing: border-box;
        }

        /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑—É–º–∞ –∏ –∂–µ—Å—Ç–æ–≤ */
        * {
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
        }
        
        /* –†–∞–∑—Ä–µ—à–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ input –ø–æ–ª—è—Ö */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }
        
        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ */
        body {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        /* Telegram Mini Apps —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .tg-app {
            height: 100vh; /* Fallback */
            height: var(--tg-viewport-height, 100vh);
            overflow: hidden;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ —É–±–∏—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        .player-inactive {
            pointer-events: auto;
            cursor: pointer;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }

        /* --- GRID DASHBOARD STYLES FOR SCORES --- */
        .scores-list {
            padding-bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            box-sizing: border-box;
            padding-top: 84px;
            padding-left: 16px;
            padding-right: 16px;
        }

        .score-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(16px) saturate(140%);
            -webkit-backdrop-filter: blur(16px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 22px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.1);
            width: 100%;
            position: relative;
        }

        .score-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 22px;
            background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
            opacity: 0.7;
        }

        .score-card.highlighted {
            background: rgba(174, 140, 255, 0.12);
            border-color: rgba(174, 140, 255, 0.35);
            box-shadow: 0 0 0 1px rgba(174,140,255,0.3), 0 8px 32px rgba(174,140,255,0.15);
            transform: scale(1.01);
            z-index: 10;
        }

        .score-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            background: transparent;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .score-card.highlighted .score-header {
            background: linear-gradient(90deg, rgba(174,140,255,0.08) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .score-content {
            padding: 12px;
            background: rgba(0,0,0,0.15);
            width: 100%;
            position: relative;
            z-index: 1;
        }

        /* GRID LAYOUT */
        .score-dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            width: 100%;
        }

        .dashboard-cell {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 80px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .dashboard-cell::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
            opacity: 0.5;
        }

        .dashboard-cell.full-width {
            grid-column: 1 / -1;
            min-height: auto;
        }

        .cell-label {
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: space-between;
            white-space: nowrap;
        }

        /* Opinion & Protocol Lists */
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
            width: 100%;
        }

        .info-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85em;
            padding: 4px 8px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            width: 100%;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .info-text-mini {
            font-size: 0.9em;
            font-style: italic;
            color: #ccc;
            line-height: 1.4;
            padding: 4px;
            word-wrap: break-word;
        }

        /* Inputs */
        .math-input-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .math-input {
            width: 100%;
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.08);
            color: #fff;
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.2em;
            font-weight: bold;
            outline: none;
            transition: all 0.2s;
            min-width: 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .math-input:focus {
            border-color: var(--maf-accent-color);
            background: rgba(0,0,0,0.35);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 0 2px var(--maf-accent-color);
        }

        .math-input.positive { color: #30d158; }
        .math-input.negative { color: #ff453a; }

        /* Status & Total */
        .status-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .total-content {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100%;
        }

        .total-value {
            font-size: 2em;
            font-weight: 800;
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #fff 0%, var(--maf-accent-color, #ae8cff) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            filter: drop-shadow(0 0 8px rgba(174,140,255,0.2));
        }

        .win-badge {
            font-size: 0.7em;
            background: rgba(255, 214, 10, 0.12);
            color: #ffd60a;
            padding: 3px 8px;
            border-radius: 8px;
            margin-top: 4px;
            white-space: nowrap;
            border: 1px solid rgba(255,214,10,0.15);
        }

        /* Common Elements */
        .role-tag {
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 0.75em;
            margin-left: 10px;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            backdrop-filter: blur(4px);
        }

        .role-tag.peace { background: rgba(30,58,138,0.6); color: #90caf9; border: 1px solid rgba(144, 202, 249, 0.15); }
        .role-tag.sheriff { background: rgba(66,54,2,0.6); color: #ffd54f; border: 1px solid rgba(255, 213, 79, 0.15); }
        .role-tag.mafia { background: rgba(62,26,26,0.6); color: #ef9a9a; border: 1px solid rgba(239, 154, 154, 0.15); }
        .role-tag.don { background: rgba(74,20,140,0.6); color: #e1bee7; border: 1px solid rgba(225, 190, 231, 0.15); }

        .player-num-badge {
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9em;
            color: #aaa;
            flex-shrink: 0;
        }

        .score-card.highlighted .player-num-badge {
            background: var(--maf-accent-color);
            color: #000;
        }

        .check-icon { color: #30d158; margin-left: 4px; }
        .cross-icon { color: #ff453a; margin-left: 4px; }

        .self-kill-status {
            color: #ff453a;
            font-weight: bold;
            font-size: 0.85em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(255, 69, 58, 0.5);
            animation: pulse-red 2s infinite;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: 100%;
        }

        @keyframes pulse-red {
            0% { text-shadow: 0 0 5px rgba(255, 69, 58, 0.3); opacity: 0.8; }
            50% { text-shadow: 0 0 15px rgba(255, 69, 58, 0.7); opacity: 1; }
            100% { text-shadow: 0 0 5px rgba(255, 69, 58, 0.3); opacity: 0.8; }
        }

        .empty-data {
            font-size: 0.8em;
            color: rgba(255,255,255,0.25);
            text-align: center;
            margin-top: auto;
            margin-bottom: auto;
        }

        /* --- REVEAL BUTTON STYLE --- */
        .reveal-btn {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255,255,255,0.6);
            padding: 6px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 60px;
            text-align: center;
            outline: none;
        }

        .reveal-btn:active {
            transform: scale(0.92);
        }

        .reveal-btn.active {
            background: rgba(48, 209, 88, 0.15);
            border-color: rgba(48,209,88,0.35);
            color: #30d158;
            box-shadow: 0 0 12px rgba(48, 209, 88, 0.15);
        }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 380px) {
            .score-content {
                padding: 8px;
            }
            .score-dashboard-grid {
                gap: 6px;
            }
            .dashboard-cell {
                padding: 8px 6px;
                min-height: 70px;
            }
            .cell-label {
                font-size: 0.65em;
                margin-bottom: 6px;
            }
            .math-input {
                font-size: 1em;
                padding: 6px;
            }
            .total-value {
                font-size: 1.6em;
            }
            .role-tag {
                margin-left: 6px;
                padding: 2px 6px;
                font-size: 0.7em;
            }
            .info-item {
                font-size: 0.8em;
                padding: 3px 6px;
            }
            .reveal-btn {
                padding: 4px 10px;
                font-size: 0.85em;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp) {
    const tg = window.Telegram.WebApp;
    
    // 1. –ë–∞–∑–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π)
    tg.expand();
    
    // 2. –ü–æ–ø—ã—Ç–∫–∞ –≤–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (Bot API 8.0+)
    if (typeof tg.requestFullscreen === 'function') {
        tg.requestFullscreen();
    }
    
    // 3. –û—Ç–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
    if (typeof tg.disableVerticalSwipes === 'function') {
        tg.disableVerticalSwipes();
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ö–µ–¥–µ—Ä–∞ –∏ —Ñ–æ–Ω–∞
    tg.setHeaderColor('#0c0a1e');
    tg.setBackgroundColor('#0c0a1e');

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.body.classList.add('tg-app');
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –≤—å—é–ø–æ—Ä—Ç–∞
    function updateViewportHeight() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º tg.viewportStableHeight –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ, –∏–Ω–∞—á–µ viewportHeight
        const vh = tg.viewportStableHeight || tg.viewportHeight;
        if (vh) {
            document.documentElement.style.setProperty('--tg-viewport-height', `${vh}px`);
        }
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—å—é–ø–æ—Ä—Ç–∞
    tg.onEvent('viewportChanged', updateViewportHeight);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    updateViewportHeight();
    setTimeout(updateViewportHeight, 100);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
    tg.ready();
    
    // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
    tg.enableClosingConfirmation();
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
    window.haptic = {
        impact: (style = 'light') => {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred(style);
        },
        notification: (type = 'success') => {
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred(type);
        },
        selection: () => {
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        }
    };
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
    window.sessionManager = {
        // –ö–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        SESSION_KEY: 'maf_panel_session_data',
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        saveSession: function(data) {
            try {
                const sessionData = {
                    ...data,
                    timestamp: Date.now()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem(this.SESSION_KEY, JSON.stringify(sessionData));
                
                // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Telegram CloudStorage –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                if (tg.CloudStorage) {
                    tg.CloudStorage.setItem(this.SESSION_KEY, JSON.stringify(sessionData));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
            }
        },
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        getSession: function() {
            try {
                const localData = localStorage.getItem(this.SESSION_KEY);
                if (localData) {
                    return JSON.parse(localData);
                }
                return null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–∏:', error);
                return null;
            }
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏ (3 —á–∞—Å–∞)
        isSessionValid: function(sessionData) {
            if (!sessionData || !sessionData.timestamp) {
                return false;
            }
            
            const now = Date.now();
            const sessionTime = sessionData.timestamp;
            const threeHours = 3 * 60 * 60 * 1000; // 3 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
            
            return (now - sessionTime) < threeHours;
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –∑–Ω–∞—á–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏
        hasSignificantData: function(sessionData) {
            if (!sessionData) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –∫–æ–º–Ω–∞—Ç–∞ –ò (—Ç—É—Ä–Ω–∏—Ä –ò–õ–ò —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º —Å –∏–≥—Ä–æ–∫–∞–º–∏)
            return sessionData.roomId && (
                sessionData.tournamentId || 
                (sessionData.manualMode && sessionData.manualPlayers && sessionData.manualPlayers.length > 0)
            );
        },
        
        // –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
        clearSession: function() {
            try {
                localStorage.removeItem(this.SESSION_KEY);
                if (tg.CloudStorage) {
                    tg.CloudStorage.removeItem(this.SESSION_KEY);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Å—Å–∏–∏:', error);
            }
        }
    };
} else {
    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è haptic, –µ—Å–ª–∏ –Ω–µ –≤ Telegram
    window.haptic = {
        impact: () => {},
        notification: () => {},
        selection: () => {}
    };
}
</script>
<script>document.write('<script src="./login/auth.js?v=' + window.__v + '"><\/script>');</script>
<div id="app" :class="{ 'obs-cef': isObs }">
    <!-- –ë–∞–Ω–Ω–µ—Ä –æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ -->
    <div v-if="!isActivePanel && activePanelId && roomId" class="top-banner">
        <b>–í–Ω–∏–º–∞–Ω–∏–µ!</b> –í —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å.<br>
        <button @click="activateThisPanel(); window.haptic.impact('medium');">
            –°–¥–µ–ª–∞—Ç—å —ç—Ç—É –ø–∞–Ω–µ–ª—å –≥–ª–∞–≤–Ω–æ–π
        </button>
    </div>
    
    <div :class="{ 'content-shifted': (!isActivePanel && activePanelId && roomId) }">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–≥—Ä (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å) -->
        <div v-if="showMainMenu" class="main-menu-screen">
            <div class="main-menu-container">
                <div class="main-menu-header">
                    <div class="main-menu-logo">
                        <i class="mdi mdi-cards-playing-outline"></i>
                    </div>
                    <h1 class="main-menu-title">MafBoard</h1>
                    <p class="main-menu-subtitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ñ–∏–µ–π</p>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä -->
                <div v-if="sessionsList && sessionsList.length > 0" class="main-menu-history">
                    <div class="main-menu-history-title">
                        <i class="fa fa-history" style="margin-right: 6px; opacity: 0.6;"></i>
                        {{ activeHistoryTab === 'active' ? '–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã' : '–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä' }}
                        <span class="main-menu-history-count">
                            {{ activeHistoryTab === 'active' ? getActiveSessions().length : getHistorySessions().length }}
                        </span>
                    </div>

                    <div class="main-menu-sessions-list">
                        <div v-for="session in (activeHistoryTab === 'active' ? getActiveSessions() : getHistorySessions())"
                             :key="session.sessionId"
                             class="main-menu-session-card"
                             @click="openSession(session.sessionId); window.haptic.impact('light');">

                            <div class="session-card-header">
                                <div class="session-card-name">{{ getSessionDisplayName(session) }}</div>
                                <div class="session-card-time">{{ formatSessionTime(session.timestamp) }}</div>
                            </div>

                            <div class="session-card-details">
                                <span class="session-card-status">{{ getSessionStatusText(session) }}</span>
                                <span v-if="getSessionModeText(session)" class="session-card-mode">{{ getSessionModeText(session) }}</span>
                                <span class="session-card-room">{{ getSessionRoomText(session) }}</span>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä (–≤ –∏—Å—Ç–æ—Ä–∏–∏ —É–¥–∞–ª—è—Ç—å –Ω–µ–ª—å–∑—è) -->
                            <button v-if="activeHistoryTab === 'active'" class="session-card-delete"
                                    @click.stop="deleteSession(session.sessionId); window.haptic.impact('light');"
                                    title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>

                        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏ -->
                        <div v-if="(activeHistoryTab === 'active' ? getActiveSessions() : getHistorySessions()).length === 0" class="main-menu-empty-tab">
                            <div class="main-menu-empty-text">–ù–µ—Ç {{ activeHistoryTab === 'active' ? '–∞–∫—Ç–∏–≤–Ω—ã—Ö' : '–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö' }} –∏–≥—Ä</div>
                        </div>
                    </div>
                </div>

                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–µ—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç —Å–µ—Å—Å–∏–π) -->
                <div v-else class="main-menu-empty">
                    <div class="main-menu-empty-icon">üé≤</div>
                    <div class="main-menu-empty-text">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏–≥—Ä</div>
                    <div class="main-menu-empty-hint">
                        –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É ‚Äî –æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ü—Ä–æ—Ñ–∏–ª—å (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showProfileScreen" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <h1 class="fullscreen-page-title">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                </div>

                <div class="profile-avatar-section">
                    <div class="profile-avatar" :style="judgeAvatarUrl ? {backgroundImage: 'url(' + judgeAvatarUrl + ')'} : {}">
                        <i v-if="!judgeAvatarUrl" class="fa fa-user profile-avatar-placeholder"></i>
                    </div>
                    <div class="profile-avatar-hint">–ê–≤–∞—Ç–∞—Ä –∏–∑ Telegram</div>
                </div>

                <div class="profile-field">
                    <label class="profile-field-label">–ù–∏–∫–Ω–µ–π–º</label>
                    <input type="text" class="profile-field-input" v-model="judgeNickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="50">
                    <div class="profile-field-hint">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã –≤ –¢–µ–ª–µ–≥—Ä–∞–º</div>
                </div>

                <button class="glass-btn w-full btn-primary mt-20" @click="saveJudgeNickname(); window.haptic.notification('success');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¢–µ–º—ã (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showThemesScreen" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <h1 class="fullscreen-page-title">–¢–µ–º—ã</h1>
                </div>

                <div class="text-center text-secondary font-bold text-large mb-10" style="letter-spacing:.02em;">
                    {{ colorSchemes.find(s=>s.key===selectedColorScheme)?.name || '' }}
                </div>
                <div class="theme-grid">
                    <div v-for="scheme in colorSchemes"
                         :key="scheme.key"
                         :title="scheme.name"
                         class="theme-preview-item"
                         @click="applyColorSchemeGlobal(scheme.key); window.haptic.selection();"
                         :style="{
                            border: selectedColorScheme === scheme.key ? '4px solid #fff' : '2px solid var(--maf-accent-color)',
                            background: scheme.preview,
                            outline: selectedColorScheme === scheme.key ? '3px solid ' + scheme.accent : 'none',
                            outlineOffset: selectedColorScheme === scheme.key ? '2px' : '0'
                         }">
                        <span>{{scheme.icon || '‚òÖ'}}</span>
                        <span v-if="selectedColorScheme === scheme.key" class="check">‚úî</span>
                    </div>
                </div>

                <div class="text-center text-secondary font-bold text-large" style="margin:24px 0 12px 0;">
                    –§–æ–Ω –ø–∞–Ω–µ–ª–∏
                </div>
                <div class="theme-grid">
                    <div v-for="theme in backgroundThemes"
                         :key="theme.key"
                         :title="theme.name"
                         class="theme-preview-item"
                         @click="applyBackgroundThemeGlobal(theme.key); window.haptic.selection();"
                         :style="{
                            border: selectedBackgroundTheme === theme.key ? '4px solid #fff' : '2px solid var(--maf-accent-color)',
                            background: theme.bgMain,
                            outline: selectedBackgroundTheme === theme.key ? '3px solid var(--maf-accent-color)' : 'none',
                            outlineOffset: selectedBackgroundTheme === theme.key ? '2px' : '0'
                         }">
                        <span>{{theme.icon}}</span>
                        <span v-if="selectedBackgroundTheme === theme.key" class="check">‚úî</span>
                    </div>
                </div>

                <button class="theme-save-btn" @click="showThemesScreen = false; activeHistoryTab = 'active'; window.haptic.notification('success');">
                    <i class="mdi mdi-check-circle-outline" style="margin-right: 8px; font-size: 1.2em;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ -->
        <div v-if="showModal && !showMainMenu && !showGameTableModal" class="modal">
            <div class="modal-content">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                <div class="mode-select-buttons">
                    <div
                        class="mode-btn"
                        :class="{selected: inputMode === 'gomafia'}"
                        tabindex="0"
                        @click="inputMode = 'gomafia'; window.haptic.selection();"
                        @keydown.enter.space="inputMode = 'gomafia'"
                        role="button"
                    >
                        <img src="./icon/gomafia.png" alt="Gomafia" />
                        <div class="selection-info">
                            <div class="selection-title">GoMafia</div>
                            <div class="selection-desc">–¢—É—Ä–Ω–∏—Ä–Ω—ã–π —Ä–µ–∂–∏–º</div>
                        </div>
                    </div>
                    <div
                        class="mode-btn"
                        :class="{selected: inputMode === 'manual'}"
                        tabindex="0"
                        @click="inputMode = 'manual'; window.haptic.selection();"
                        @keydown.enter.space="inputMode = 'manual'"
                        role="button"
                    >
                        <img src="./icon/goruchkami.png" alt="Go–†—É—á–∫–∞–º–∏" />
                        <div class="selection-info">
                            <div class="selection-title">Go–†—É—á–∫–∞–º–∏</div>
                            <div class="selection-desc">–†—É—á–Ω–∞—è —Ä–∞—Å—Å–∞–¥–∫–∞</div>
                        </div>
                    </div>
                </div>

                <div v-if="inputMode === 'gomafia'" class="modal-fields mt-16">
                    <div class="selection-card" style="cursor: default; background: rgba(255,255,255,0.03);">
                        <div class="selection-icon">
                            <i class="mdi mdi-trophy-outline" style="color: #ffd700;"></i>
                        </div>
                        <div class="selection-info" style="flex-grow: 1;">
                            <input
                                type="text"
                                inputmode="numeric"
                                pattern="[0-9]*"
                                v-model="tournamentId"
                                placeholder="–ù–æ–º–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞"
                                style="background: transparent; border: none; box-shadow: none; padding: 0; font-size: 1.2em; font-weight: 700;"
                                @keydown.enter="loadTournament(); window.haptic.impact('medium');"
                                @input="tournamentId = tournamentId.replace(/[^0-9]/g, '')"
                            >
                        </div>
                    </div>
                    <button class="glass-btn w-full btn-primary" @click="loadTournament(); window.haptic.impact('medium');">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
                </div>

                <div v-else-if="inputMode === 'manual'" class="modal-fields mt-16">
                    <div class="selection-card" style="cursor: default; background: rgba(255,255,255,0.03);">
                        <div class="selection-icon">
                            <i class="mdi mdi-account-group-outline" style="color: var(--accent-color);"></i>
                        </div>
                        <div class="selection-info" style="flex-grow: 1;">
                            <input
                                type="number"
                                min="1"
                                max="15"
                                v-model.number="manualPlayersCount"
                                placeholder="–ö–æ–ª-–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (1-15)"
                                style="background: transparent; border: none; box-shadow: none; padding: 0; font-size: 1.2em; font-weight: 700;"
                            >
                        </div>
                    </div>
                    <button class="glass-btn w-full btn-primary" @click="createManualTable(); window.haptic.impact('medium');">–°–æ–∑–¥–∞—Ç—å —Å—Ç–æ–ª</button>
                </div>

                <button class="glass-btn w-full mt-16" style="opacity: 0.5; font-size: 0.9em;" @click="showModal = false; returnToMainMenu(); window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right:8px;"></i>
                    –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã –∏ —Å—Ç–æ–ª–∞ -->
        <div v-if="showGameTableModal && !showMainMenu" class="modal">
            <div class="modal-content">
                <h2 style="margin-bottom: 4px;">
                    <i class="mdi mdi-table-furniture" style="margin-right: 8px; color: var(--maf-accent-color, #ae8cff);"></i>
                    –í—ã–±–æ—Ä —Å—Ç–æ–ª–∞
                </h2>
                <div v-if="tournamentName" class="text-secondary" style="font-size: 0.85em; margin-bottom: 16px; text-align: center;">
                    {{ tournamentName }}
                </div>

                <!-- –í—ã–±–æ—Ä –∏–≥—Ä—ã -->
                <div class="selection-card" style="cursor: pointer; background: rgba(255,255,255,0.03); position: relative; overflow: hidden;">
                    <div class="selection-icon">
                        <i class="mdi mdi-gamepad-variant-outline" style="color: #ffd700;"></i>
                    </div>
                    <div class="selection-info" style="flex-grow: 1;">
                        <div style="font-size: 0.75em; color: rgba(255,255,255,0.5); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">–ò–≥—Ä–∞</div>
                        <div style="font-size: 1.2em; font-weight: 700; color: #fff;">–ò–≥—Ä–∞ {{ gameSelected }}</div>
                    </div>
                    <i class="mdi mdi-chevron-down" style="color: rgba(255,255,255,0.4); font-size: 1.4em;"></i>
                    <select
                        v-model.number="gameSelected"
                        @change="onGameSelectChange($event)"
                        style="position: absolute; inset: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; font-size: 16px;">
                        <option v-for="game in games" :value="game.gameNum" style="background: #1a1640; color: #fff;">
                            –ò–≥—Ä–∞ {{ game.gameNum }}
                        </option>
                    </select>
                </div>

                <!-- –í—ã–±–æ—Ä —Å—Ç–æ–ª–∞ -->
                <div v-if="gameSelectedObject && gameSelectedObject.length > 1" class="selection-card mt-10" style="cursor: pointer; background: rgba(255,255,255,0.03); position: relative; overflow: hidden;">
                    <div class="selection-icon">
                        <i class="mdi mdi-table-chair" style="color: var(--maf-accent-color, #ae8cff);"></i>
                    </div>
                    <div class="selection-info" style="flex-grow: 1;">
                        <div style="font-size: 0.75em; color: rgba(255,255,255,0.5); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">–°—Ç–æ–ª</div>
                        <div style="font-size: 1.2em; font-weight: 700; color: #fff;">–°—Ç–æ–ª {{ tableSelected }}</div>
                    </div>
                    <i class="mdi mdi-chevron-down" style="color: rgba(255,255,255,0.4); font-size: 1.4em;"></i>
                    <select
                        v-model.number="tableSelected"
                        style="position: absolute; inset: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; font-size: 16px;">
                        <option v-for="tableEl in gameSelectedObject" :value="Number(tableEl.tableNum)" style="background: #1a1640; color: #fff;">
                            –°—Ç–æ–ª {{ tableEl.tableNum }}
                        </option>
                    </select>
                </div>

                <!-- –ò–Ω—Ñ–æ: –æ–¥–∏–Ω —Å—Ç–æ–ª -->
                <div v-if="gameSelectedObject && gameSelectedObject.length === 1" class="selection-card mt-10" style="cursor: default; background: rgba(255,255,255,0.03); opacity: 0.7;">
                    <div class="selection-icon">
                        <i class="mdi mdi-table-chair" style="color: var(--maf-accent-color, #ae8cff);"></i>
                    </div>
                    <div class="selection-info">
                        <div style="font-weight: 700; font-size: 1em;">–°—Ç–æ–ª {{ gameSelectedObject[0]?.tableNum }}</div>
                        <div style="font-size: 0.8em; color: rgba(255,255,255,0.4);">–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–æ–ª –≤ —ç—Ç–æ–π –∏–≥—Ä–µ</div>
                    </div>
                </div>

                <button class="glass-btn w-full mt-16 btn-primary" @click="confirmGameTable(); window.haptic.impact('medium');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –ù–∞—á–∞—Ç—å
                </button>
                <button class="glass-btn w-full mt-10" style="opacity: 0.5; font-size: 0.9em;" @click="showGameTableModal = false; tournament = undefined; showModal = true; window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right: 8px;"></i>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –õ—É—á—à–µ–≥–æ –•–æ–¥–∞ -->
        <div v-if="showBestMoveModal" class="modal">
            <div class="best-move-modal-content">
                <h2>–õ—É—á—à–∏–π —Ö–æ–¥</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ—Ö –∏–≥—Ä–æ–∫–æ–≤:</p>
                <div class="modal-grid">
                    <button v-for="n in 9" :key="'bm'+n"
                            class="modal-btn"
                            :class="{ selected: bestMove.includes(n) }"
                            :disabled="tableOut[n-1]?.roleKey === firstKilledPlayer"
                            @click="toggleBestMove(n); window.haptic.selection();">
                        {{ n }}
                    </button>
                    <button v-if="tableOut.length >= 10"
                            class="modal-btn"
                            :class="{ selected: bestMove.includes(10) }"
                            :disabled="tableOut[9]?.roleKey === firstKilledPlayer"
                            @click="toggleBestMove(10); window.haptic.selection();">
                        10
                    </button>
                </div>
                <div class="modal-actions">
                    <button class="glass-btn btn-primary" @click="confirmBestMove(); window.haptic.notification('success');">–ü—Ä–∏–Ω—è—Ç—å –õ–•</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
        <div v-if="showWinnerModal" class="modal">
            <div class="modal-content">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</h2>
                <div class="winner-selection-grid">
                    <div class="winner-card civilians" @click="setWinnerTeam('civilians'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="mdi mdi-account-group"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ü–æ–±–µ–¥–∞ –º–∏—Ä–Ω—ã—Ö</div>
                            <div class="winner-desc">–ö—Ä–∞—Å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</div>
                        </div>
                    </div>

                    <div class="winner-card mafia" @click="setWinnerTeam('mafia'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="mdi mdi-skull"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ü–æ–±–µ–¥–∞ –º–∞—Ñ–∏–∏</div>
                            <div class="winner-desc">–ß–µ—Ä–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</div>
                        </div>
                    </div>

                    <div class="winner-card draw" @click="setWinnerTeam('draw'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="fa fa-handshake"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ù–∏—á—å—è</div>
                            <div class="winner-desc">–†–∞–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                        </div>
                    </div>
                </div>
                <button class="glass-btn btn-danger mt-16 w-full" @click="showWinnerModal = false; window.haptic.impact('light');">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>

        <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å) -->
        <div v-if="winnerTeam && tableOut?.length" class="scores-list">
            <div class="text-center font-bold text-large mb-20" style="text-shadow: 0 0 15px rgba(255,255,255,0.3);">
                –ü–æ–±–µ–¥–∏–ª–∏: <span :style="{color: winnerTeam === 'civilians' ? '#ff5252' : (winnerTeam === 'mafia' ? '#4fc3f7' : '#fff')}">
                    {{ winnerTeam === 'civilians' ? '–ú–∏—Ä–Ω—ã–µ' : (winnerTeam === 'mafia' ? '–ú–∞—Ñ–∏—è' : '–ù–∏—á—å—è') }}
                </span>
            </div>

            <div v-for="(playerData, index) in tableOut"
                 :key="playerData.roleKey"
                 class="score-card"
                 :class="{ 'highlighted': highlightedPlayer === playerData.roleKey }"
                 @click="toggleHighlight(playerData.roleKey, $event); window.haptic.selection();">

                <div class="player-row-content">
                    <b class="flex-fixed player-num">{{index + 1}}</b>
                    <div class="avatar-uploader flex-fixed">
                        <div class="avatar" :style="{backgroundImage: playerData.avatarCss}"></div>
                    </div>
                    <div class="text-ellipsis player-name">{{playerData.login}}</div>
                    <div class="role-badges-right">
                        <span class="role-tag" :class="playerData.role || 'peace'">
                            {{ getRoleLabel(playerData.role) }}
                        </span>
                        <b style="font-size: 1.2em; margin-left: 10px; min-width: 30px; text-align: right;">{{ calculatePlayerScore(playerData.roleKey) }}</b>
                    </div>
                </div>

                <transition name="slide-fade">
                    <div v-if="highlightedPlayer === playerData.roleKey" class="score-content" @click.stop>
                        <div class="score-dashboard-grid">
                            <!-- –†—è–¥ 1: –ü—Ä–æ—Ç–æ–∫–æ–ª | –ú–Ω–µ–Ω–∏–µ -->
                            <div class="dashboard-cell">
                                <div class="cell-label">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>
                                <div class="info-list">
                                    <div v-if="checkProtocol(playerData.roleKey)">
                                        <div v-for="(res, idx) in checkProtocol(playerData.roleKey)" :key="'prot'+idx" class="info-item">
                                            <span>#{{ idx }}</span>
                                            <div class="flex align-center">
                                                <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                </div>
                            </div>

                            <div class="dashboard-cell">
                                <div class="cell-label">–ú–Ω–µ–Ω–∏–µ</div>
                                <div class="info-list">
                                    <div v-if="checkOpinion(playerData.roleKey)">
                                        <div v-for="(res, idx) in checkOpinion(playerData.roleKey)" :key="'opin'+idx" class="info-item">
                                            <span>#{{ idx }}</span>
                                            <div class="flex align-center">
                                                <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                </div>
                            </div>

                            <!-- –†—è–¥ 2: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –º–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                            <div v-if="getOpinionText(playerData.roleKey)" class="dashboard-cell full-width">
                                <div class="cell-label">–¢–µ–∫—Å—Ç –º–Ω–µ–Ω–∏—è</div>
                                <div class="info-text-mini">
                                    "{{ getOpinionText(playerData.roleKey) }}"
                                </div>
                            </div>

                            <!-- –†—è–¥ 3: –î–æ–ø | –®—Ç—Ä–∞—Ñ -->
                            <div class="dashboard-cell">
                                <div class="cell-label" style="color:#4caf50;"><i class="fa fa-plus"></i> –î–æ–ø</div>
                                <div class="math-input-container">
                                    <div class="math-input-wrapper">
                                        <button class="math-btn minus" @click="adjustScore(playerData.roleKey, 'bonus', -0.1); window.haptic.impact('light');">-</button>
                                        <input type="number" step="0.1" class="math-input positive"
                                               placeholder="0"
                                               :value="playerScores[playerData.roleKey]?.bonus || ''"
                                               @input="updatePlayerScore(playerData.roleKey, 'bonus', $event.target.value)">
                                        <button class="math-btn plus" @click="adjustScore(playerData.roleKey, 'bonus', 0.1); window.haptic.impact('light');">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="dashboard-cell">
                                <div class="cell-label" style="color:#f44336;"><i class="fa fa-minus"></i> –®—Ç—Ä–∞—Ñ</div>
                                <div class="math-input-container">
                                    <div class="math-input-wrapper">
                                        <button class="math-btn minus" @click="adjustScore(playerData.roleKey, 'penalty', -0.1); window.haptic.impact('light');">-</button>
                                        <input type="number" step="0.1" class="math-input negative"
                                               placeholder="0"
                                               :value="playerScores[playerData.roleKey]?.penalty || ''"
                                               @input="updatePlayerScore(playerData.roleKey, 'penalty', $event.target.value)">
                                        <button class="math-btn plus" @click="adjustScore(playerData.roleKey, 'penalty', 0.1); window.haptic.impact('light');">+</button>
                                    </div>
                                </div>
                            </div>

                            <!-- –†—è–¥ 4: –í—Å–∫—Ä—ã—Ç–∏–µ | –ò—Ç–æ–≥–æ -->
                            <div class="dashboard-cell">
                                <div class="cell-label">–°—Ç–∞—Ç—É—Å</div>
                                <div class="status-content">
                                    <div class="status-row">
                                        <span class="status-text">–í—Å–∫—Ä—ã—Ç–∏–µ</span>
                                        <button class="reveal-btn"
                                                :class="{ 'active': playerScores[playerData.roleKey]?.reveal }"
                                                @click="toggleReveal(playerData.roleKey); window.haptic.impact('light');">
                                            {{ playerScores[playerData.roleKey]?.reveal ? '–î–∞' : '–ù–µ—Ç' }}
                                        </button>
                                    </div>
                                    <div v-if="(playerData.role === 'don' || playerData.role === 'black') && playerData.action === 'killed'" class="self-kill-status">
                                        <i class="mdi mdi-skull" style="margin-right: 6px;"></i> –°–ê–ú–û–°–¢–†–ï–õ
                                    </div>
                                </div>
                            </div>

                            <div class="dashboard-cell" style="background: rgba(var(--maf-accent-color-rgb), 0.05); border-color: rgba(var(--maf-accent-color-rgb), 0.2);">
                                <div class="cell-label" style="color: var(--maf-accent-color);">–ò—Ç–æ–≥–æ</div>
                                <div class="total-content">
                                    <span class="total-value">{{ calculatePlayerScore(playerData.roleKey) }}</span>
                                    <div v-if="(winnerTeam === 'civilians' && (!playerData.role || playerData.role === 'sheriff')) || (winnerTeam === 'mafia' && (playerData.role === 'don' || playerData.role === 'black'))" class="win-badge">
                                        +1 –ü–æ–±–µ–¥–∞
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
            </div>

            <button class="glass-btn w-full btn-primary mt-20" @click="sendResultsToTelegram(); window.haptic.notification('success');">
                <i class="fa fa-paper-plane" style="margin-right:8px;"></i>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –¢–µ–ª–µ–≥—Ä–∞–º
            </button>

            <button class="glass-btn w-full btn-danger mt-10" @click="setWinnerTeam(null); window.haptic.impact('light');">
                <i class="fa fa-arrow-left" style="margin-right:8px;"></i>
                –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–≥—Ä–µ
            </button>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∏–≥—Ä–æ–∫–æ–≤ (—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å) -->
        <div v-else-if="tableOut?.length" class="players-list">
            <div v-for="(playerData, index) in tableOut"
                 :key="playerData.roleKey"
                 class="player-row"
                 :class="{
                    'highlighted': highlightedPlayer === playerData.roleKey,
                    'killed': playerData.action === 'killed',
                    'voted': playerData.action === 'voted',
                    'removed': playerData.action === 'removed',
                    'tech-fall-removed': playerData.action === 'tech_fall_removed',
                    'fall-removed': playerData.action === 'fall_removed',
                    'mode-day': currentMode==='day',
                    'mode-night': currentMode==='night',
                    'mode-old': currentMode==='old',
                    'foul-4': currentMode==='day' && playerData.foul===4,
                    'player-inactive': ['removed','killed','voted','tech_fall_removed','fall_removed'].includes(playerData.action)
                 }"
                 :style="{'--i':index}"
                 onclick="void(0)"
                 @click="toggleHighlight(playerData.roleKey, $event); window.haptic.selection();"
            >
                <div class="player-row-content">
                    <b class="flex-fixed player-num">{{index + 1}}</b>
                    <div class="avatar-uploader flex-fixed">
                        <div class="avatar" :style="{backgroundImage: playerData.avatarCss}"></div>
                        <div v-if="avatarExHas(playerData.roleKey)" class="avatar-x" @click.stop="avatarExSet(playerData.roleKey); window.haptic.impact('light');">
                            <i class="fa fa-times"></i>
                        </div>
                        <div class="hovered" @click.stop="avatarExLoad(playerData.roleKey)">
                            <i class="fa fa-camera"></i>
                            <input type="file" accept="image/*" @change="onAvatarExUpload($event, playerData.roleKey)" ref="fileInputs" />
                        </div>
                    </div>
                    <template v-if="manualMode">
                        <template v-if="manualGameSelected === 1">
                            <input class="input-compact" v-model="manualPlayers[index].login" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞">
                        </template>
                        <template v-else>
                            <select v-model="manualPlayers[index].login" @change="onManualSelectPlayer(index)">
                                <option value="">‚Äî –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ ‚Äî</option>
                                <option v-for="(p, idx) in firstGamePlayers" :value="p.login">{{p.login}}</option>
                            </select>
                        </template>
                    </template>
                    <div v-else class="text-ellipsis player-name">{{playerData.login}}</div>
                    <div class="role-badges-right">
                        <!-- –ö–Ω–æ–ø–∫–∞ –í–µ—Ä–Ω—É—Ç—å –∏–≥—Ä–æ–∫–∞ –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ -->
                        <template v-if="['removed','killed','voted','tech_fall_removed','fall_removed'].includes(playerData.action)">
                            <button class="role-button return-player-btn" @click.stop="clearPlayerStatus(playerData.roleKey); window.haptic.impact('medium');" title="–í–µ—Ä–Ω—É—Ç—å –∏–≥—Ä–æ–∫–∞">‚ù§Ô∏è</button>
                        </template>
                        <template v-else>
                        <!-- –†–µ–∂–∏–º –†–æ–ª–∏ -->
                        <template v-if="currentMode==='roles'">
                            <button class="role-button" :class="{ active: playerData.role === 'don' }" @click.stop="roleSet(playerData.roleKey, 'don'); window.haptic.impact('light');" title="–î–æ–Ω">–î</button>
                            <button class="role-button" :class="{ active: playerData.role === 'black' }" @click.stop="roleSet(playerData.roleKey, 'black'); window.haptic.impact('light');" title="–ú–∞—Ñ–∏—è">–ú</button>
                            <button class="role-button" :class="{ active: playerData.role === 'sheriff' }" @click.stop="roleSet(playerData.roleKey, 'sheriff'); window.haptic.impact('light');" title="–®–µ—Ä–∏—Ñ">–®</button>
                        </template>
                        <!-- –†–µ–∂–∏–º –î–µ–Ω—å -->
                        <template v-if="currentMode==='day'">
                            <button class="role-button day-tools" @click.stop="toggleRemove(playerData.roleKey); window.haptic.impact('medium');" :title="playerData.action==='removed'?'–í–µ—Ä–Ω—É—Ç—å':'–£–¥–∞–ª–∏—Ç—å'">
                                <i class="fa fa-ban"></i>
                            </button>
                            <button class="role-button day-tools" @click.stop="toggleTechFoul(playerData.roleKey); window.haptic.impact('light');" :title="playerData.techFoul===0?'–¢–µ—Ö.—Ñ–æ–ª':'–¢–§'+playerData.techFoul">
                                ‚ö°<span v-if="playerData.techFoul>0">{{playerData.techFoul}}</span>
                            </button>
                            <button class="role-button day-tools" @click.stop="toggleFoul(playerData.roleKey); window.haptic.impact('light');" :title="'–§–æ–ª ('+playerData.foul+')'">
                                ‚ö†Ô∏è<span v-if="playerData.foul>0">{{playerData.foul}}</span>
                            </button>
                        </template>
                        <!-- –†–µ–∂–∏–º –ù–æ—á—å -->
                        <template v-if="currentMode==='night'">
                            <button class="role-button night-tools" @click.stop="actionSet(playerData.roleKey, 'killed', { nightKill: true }); window.haptic.impact('heavy');" :class="{active: playerData.action==='killed'}" title="–£–±–∏—Ç—å">
                                <i class="mdi mdi-crosshairs-gps"></i>
                            </button>
                        </template>
                        </template>
                    </div>
                </div>
                <transition name="slide-fade">
                    <div v-if="highlightedPlayer === playerData.roleKey" class="candidate-menu" @click.stop @touchstart.stop>
                        <!-- –¢–∞–π–º–µ—Ä —Å–µ–∫—Ü–∏—è (—Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º) -->
                        <div class="timer-section">
                            <div class="timer-display" :class="{ 
                                running: getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused,
                                warning: getTimerDisplay(playerData.roleKey).timeLeft <= 10 && getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused
                            }">
                                {{ formatTimerTime(getTimerDisplay(playerData.roleKey).timeLeft) }}
                            </div>
                            <div class="timer-controls">
                                <button 
                                    class="timer-btn timer-start"
                                    :disabled="getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused"
                                    @click.stop="handleTimerStart(playerData.roleKey); window.haptic.impact('light');"
                                    :title="getTimerDisplay(playerData.roleKey).isPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–°—Ç–∞—Ä—Ç'">
                                    <i class="fa fa-play"></i>
                                </button>
                                <button 
                                    class="timer-btn timer-pause"
                                    :disabled="!getTimerDisplay(playerData.roleKey).isRunning || getTimerDisplay(playerData.roleKey).isPaused"
                                    @click.stop="pausePlayerTimer(playerData.roleKey); window.haptic.impact('light');"
                                    title="–ü–∞—É–∑–∞">
                                    <i class="fa fa-pause"></i>
                                </button>
                                <button 
                                    class="timer-btn timer-add"
                                    :class="{ disabled: !isAddTimeButtonAvailable(playerData.roleKey) }"
                                    :disabled="!isAddTimeButtonAvailable(playerData.roleKey)"
                                    @click.stop="addThirtySecondsToTimer(playerData.roleKey); window.haptic.impact('light');"
                                    title="–î–æ–±–∞–≤–∏—Ç—å 30 —Å–µ–∫—É–Ω–¥">
                                    +30
                                </button>
                                <button 
                                    class="timer-btn timer-stop"
                                    @click.stop="stopPlayerTimer(playerData.roleKey); window.haptic.impact('light');"
                                    title="–°—Ç–æ–ø">
                                    <i class="fa fa-stop"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- –°–µ—Ç–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–∏–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤) -->
                        <div v-if="playerData.action !== 'killed'" class="candidate-grid">
                            <button v-for="n in tableOut.length"
                                    :key="'cand'+n"
                                    class="candidate-btn"
                                    :class="candidateButtonClass(playerData.roleKey, n)"
                                    :disabled="isCandidateButtonDisabled(playerData.roleKey, n)"
                                    @click.stop="toggleNomination(playerData.roleKey, n); window.haptic.selection();">
                                {{ n }}
                            </button>
                        </div>
                        <div v-if="playerData.action !== 'killed' && nominations[playerData.roleKey] && nominations[playerData.roleKey].length" class="text-center text-accent font-bold text-large mt-md">
                            –í—ã—Å—Ç–∞–≤–ª–µ–Ω: <span style="font-size:1.18em;">{{ nominations[playerData.roleKey][0] }}</span>
                        </div>

                        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ç–æ–∫–æ–ª –∏ –ú–Ω–µ–Ω–∏–µ –¥–ª—è —É–±–∏—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ -->
                        <div v-if="playerData.action === 'killed'" class="protocol-opinion-section">
                            <div class="protocol-section">
                                <div class="section-title">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>
                                <div class="protocol-grid">
                                    <button v-for="n in tableOut.length"
                                            :key="'prot'+n"
                                            class="protocol-btn"
                                            :class="getProtocolRoleClass(playerData.roleKey, n)"
                                            @click.stop="toggleProtocolRole(playerData.roleKey, n); window.haptic.selection();">
                                        <span class="player-num">{{ n }}</span>
                                        <span class="role-label">{{ getProtocolRoleLabel(playerData.roleKey, n) }}</span>
                                    </button>
                                </div>
                            </div>

                            <div class="opinion-section">
                                <div class="section-title">–ú–Ω–µ–Ω–∏–µ</div>
                                <div class="opinion-grid">
                                    <button v-for="n in tableOut.length"
                                            :key="'opin'+n"
                                            class="opinion-btn"
                                            :class="getOpinionRoleClass(playerData.roleKey, n)"
                                            @click.stop="toggleOpinionRole(playerData.roleKey, n); window.haptic.selection();">
                                        <span class="player-num">{{ n }}</span>
                                        <span class="role-label">{{ getOpinionRoleLabel(playerData.roleKey, n) }}</span>
                                    </button>
                                </div>
                                <textarea
                                    class="opinion-text"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –º–Ω–µ–Ω–∏–µ..."
                                    :value="opinionText && opinionText[playerData.roleKey]"
                                    @input="updateOpinionText(playerData.roleKey, $event.target.value)"
                                    @click.stop
                                    @touchstart.stop
                                ></textarea>
                            </div>
                        </div>
                    </div>
                </transition>
            </div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
        <div v-if="tableOut?.length && !winnerTeam" class="text-center font-bold text-large" style="margin:18px 0 6px 0;">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</div>

        <!-- –ö–Ω–æ–ø–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –Ω–∞—á–∞–ª–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
        <div v-if="tableOut?.length" class="modal-actions-row" style="justify-content:center; padding:0 16px; margin-bottom:18px; box-sizing:border-box;">
            <button class="glass-btn flex-1" @click="showVotingHistory = true; activeVotingTab = Math.max(0, votingHistory.length - 1); window.haptic.impact('light');" style="min-width:0;">
                <i class="fa fa-history" style="margin-right:8px;"></i>
                –ò—Å—Ç–æ—Ä–∏—è
            </button>
            <button v-if="!winnerTeam" class="glass-btn flex-1 btn-primary" @click="startVoting(); window.haptic.impact('medium');" style="min-width:0;">
                <i class="fa fa-thumbs-up" style="margin-right:8px;"></i>
                –ù–∞—á–∞—Ç—å
            </button>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π -->
        <div v-if="tableOut?.length && !winnerTeam" class="text-center font-bold text-large" style="margin:18px 0 6px 0;">–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ</div>

        <!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–±–µ–¥–∏–≤—à–µ–π –∫–æ–º–∞–Ω–¥—ã -->
        <div v-if="tableOut?.length && !winnerTeam" class="winner-team-row">
            <button class="glass-btn btn-wide btn-primary" @click="showWinnerModal = true; window.haptic.impact('medium');">
                <i class="fa fa-flag-checkered" style="margin-right:8px;"></i>
                –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
            </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –∏ –≤—ã—Ö–æ–¥–∞ -->
        <div class="game-actions-container" v-if="tableOut?.length">
            <button class="glass-btn game-broadcast-btn" @click="openBroadcastSettings(); window.haptic.impact('light');">
                <i class="fa fa-sliders-h" style="margin-right: 8px;"></i>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏
            </button>
            <button class="exit-hold-btn"
                    @touchstart.prevent="startExitHold()"
                    @touchend.prevent="cancelExitHold()"
                    @touchcancel.prevent="cancelExitHold()"
                    @mousedown.prevent="startExitHold()"
                    @mouseup.prevent="cancelExitHold()"
                    @mouseleave="cancelExitHold()">
                <i class="fa fa-sign-out-alt" style="margin-right: 6px;"></i>
                <span>–í—ã—Ö–æ–¥</span>
                <div class="exit-hold-progress" :class="{ active: exitHoldActive }"></div>
            </button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞) -->
        <div v-if="tableOut?.length && manualMode" class="game-table-panel">
            <div class="flex">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ò–≥—Ä—ã -->
                <div class="game-option-card">
                    <div class="label">–ò–≥—Ä–∞</div>
                    <select
                        v-model.number="manualGameSelected"
                        @change="onGameSelectChange($event)">
                        <option v-for="game in manualGames" :value="game.num">
                            {{game.num}}
                        </option>
                        <option value="new">+ –ù–æ–≤–∞—è</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showBroadcastSettings" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <button class="fullscreen-back-btn" @click="cancelBroadcastSettings(); window.haptic.impact('light');">
                        <i class="fa fa-arrow-left"></i>
                    </button>
                    <h1 class="fullscreen-page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</h1>
                    <div style="width: 40px;"></div>
                </div>

                <div class="broadcast-settings-body">
                    <div class="broadcast-section-title">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</div>
                    <div class="switches-bottom">
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="mainInfoVisible">
                            <span class="slider"></span>
                            <span>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="additionalInfoVisible">
                            <span class="slider"></span>
                            <span>–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideSeating">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å —Ä–∞—Å—Å–∞–¥–∫—É</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideLeaveOrder">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å –ø–æ—Ä—è–¥–æ–∫ —É—Ö–æ–¥–∞</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideRolesStatus">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å —Ä–æ–ª–∏ –∏ —Å—Ç–∞—Ç—É—Å</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideBestMove">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å –õ–•</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="showRoomNumber">
                            <span class="slider"></span>
                            <span>–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã</span>
                        </label>
                    </div>

                    <div class="broadcast-section-title" style="margin-top: 24px;">–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</div>
                    <div class="broadcast-room-field">
                        <label class="profile-field-label">–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã</label>
                        <input type="text" inputmode="numeric" pattern="[0-9]*" class="profile-field-input"
                               v-model="roomInput" maxlength="4" placeholder="1234"
                               @input="roomInput = roomInput.replace(/[^0-9]/g, '')">
                        <div class="profile-field-hint">–î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∏–≥—Ä–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∫ roles.html</div>
                    </div>
                </div>

                <button class="glass-btn w-full btn-primary mt-20" @click="saveBroadcastSettings(); window.haptic.notification('success');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
                <button class="glass-btn w-full mt-10" style="opacity: 0.6;" @click="cancelBroadcastSettings(); window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right: 8px;"></i>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
        <div v-if="showVotingModal" class="modal">
            <div class="voting-modal-content">
                <div class="voting-header w-100">
                    <div class="voting-header-title">–í—ã—Å—Ç–∞–≤–ª–µ–Ω—ã:</div>
                    <div class="voting-header-order">
                        <span v-for="(candidate, idx) in votingOrder" :key="candidate"
                              :class="['voting-header-candidate', {active: votingCurrentIndex === idx}]">
                            {{ candidate }}
                        </span>
                    </div>
                </div>
                <div class="voting-question" v-if="!votingTieTimerActive">
                    <template v-if="votingStage === 'main'">
                        –ö—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ <b>‚Ññ{{ votingOrder[votingCurrentIndex] }}</b>
                    </template>
                    <template v-else-if="votingStage === 'tie'">
                        <span class="text-large font-bold">–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span><br>
                        –ö—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ <b>‚Ññ{{ votingOrder[votingCurrentIndex] }}</b>
                    </template>
                    <template v-else-if="votingStage === 'lift'">
                        –ö—Ç–æ –∑–∞ –ø–æ–¥—ä–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤?
                    </template>
                </div>
                <div v-if="!votingTieTimerActive && (votingStage === 'main' || votingStage === 'tie')" class="modal-grid">
                    <button v-for="n in 10"
                            :key="'vote'+n"
                            :class="getVotingButtonClass(n)"
                            :disabled="!isVotingButtonEnabled(n)"
                            @click="toggleVotingSelection(n); window.haptic.selection();">
                        {{ n }}
                    </button>
                </div>
                <div v-else-if="!votingTieTimerActive && votingStage === 'lift'" class="modal-grid">
                    <button v-for="n in 10"
                            :key="'lift'+n"
                            :class="getLiftVotingButtonClass(n)"
                            :disabled="!isLiftVotingButtonEnabled(n)"
                            @click="toggleLiftVotingSelection(n); window.haptic.selection();">
                        {{ n }}
                    </button>
                </div>
                <div v-if="votingNotification" class="text-center font-bold" style="color:var(--status-error);margin-bottom:8px;">{{ votingNotification }}</div>

                <!-- –¢–∞–π–º–µ—Ä –Ω–∏—á—å–µ–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–∏ –Ω–∏—á—å–µ–π) -->
                <div v-if="votingTieTimerActive && votingTiePlayers.length > 1" class="voting-timer-section">
                    <div class="voting-timer-tie-info">
                        ‚öñÔ∏è –ù–∏—á—å—è —Å—Ä–µ–¥–∏: {{ votingTiePlayers.join(', ') }}
                    </div>
                    <div class="voting-timer-title">
                        ‚è± –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ‚Äî –ò–≥—Ä–æ–∫ ‚Ññ{{ votingTiePlayers[votingTieTimerPlayerIndex] }}
                    </div>
                    <div class="voting-timer-display" :class="{
                        'running': votingTieTimerRunning && !votingTieTimerPaused,
                        'warning': votingTieTimerTimeLeft <= 10 && votingTieTimerRunning && !votingTieTimerPaused
                    }">
                        {{ formatVotingTimerTime(votingTieTimerTimeLeft) }}
                    </div>
                    <div class="voting-timer-controls">
                        <button class="timer-btn timer-start"
                                :disabled="votingTieTimerRunning && !votingTieTimerPaused"
                                @click.stop="playVotingTieTimer(); window.haptic.impact('light');"
                                :title="votingTieTimerPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–°—Ç–∞—Ä—Ç'">
                            <i class="fa fa-play"></i>
                        </button>
                        <button class="timer-btn timer-pause"
                                :disabled="!votingTieTimerRunning || votingTieTimerPaused"
                                @click.stop="pauseVotingTieTimer(); window.haptic.impact('light');"
                                title="–ü–∞—É–∑–∞">
                            <i class="fa fa-pause"></i>
                        </button>
                        <button class="timer-btn timer-stop"
                                @click.stop="stopVotingTieTimer(); window.haptic.impact('light');"
                                title="–°–±—Ä–æ—Å">
                            <i class="fa fa-stop"></i>
                        </button>
                    </div>
                    <div class="voting-timer-nav">
                        <button class="glass-btn"
                                :disabled="votingTieTimerPlayerIndex <= 0"
                                @click.stop="prevVotingTieTimerPlayer(); window.haptic.impact('light');">
                            ‚óÄ –ü—Ä–µ–¥.
                        </button>
                        <span class="voting-timer-player-indicator">
                            {{ votingTieTimerPlayerIndex + 1 }} / {{ votingTiePlayers.length }}
                        </span>
                        <button class="glass-btn"
                                :disabled="votingTieTimerPlayerIndex >= votingTiePlayers.length - 1"
                                @click.stop="nextVotingTieTimerPlayer(); window.haptic.impact('light');">
                            –°–ª–µ–¥. ‚ñ∂
                        </button>
                    </div>
                    <button class="glass-btn btn-primary w-full"
                            @click.stop="skipVotingTieTimer(); startTieVoting(); window.haptic.impact('medium');">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é
                    </button>
                </div>

                <div class="modal-actions" v-if="!votingTieTimerActive && !votingFinished">
                    <button v-if="votingCurrentIndex > 0 || votingStage === 'lift'" class="glass-btn" @click="prevVoting(); window.haptic.impact('light');">
                        –ù–∞–∑–∞–¥
                    </button>
                    <button class="glass-btn btn-primary" @click="acceptCurrentCandidateVotes(); window.haptic.impact('medium');" :disabled="acceptDisabled">
                        –ü—Ä–∏–Ω—è—Ç—å
                    </button>
                </div>
                <div v-if="votingFinished" class="w-100 mt-md">
                    <!-- –¢–∞–π–º–µ—Ä –∫—Ä–∞–π–Ω–µ–π —Ä–µ—á–∏ -->
                    <div v-if="votingLastSpeechTimerActive && votingWinners && votingWinners.length" class="voting-timer-section">
                        <div class="voting-timer-title">
                            üé§ –ö—Ä–∞–π–Ω—è—è —Ä–µ—á—å ‚Äî –ò–≥—Ä–æ–∫ ‚Ññ{{ votingWinners[votingLastSpeechPlayerIndex] }}
                        </div>
                        <div class="voting-timer-display" :class="{
                            'running': votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused,
                            'warning': votingLastSpeechTimerTimeLeft <= 10 && votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused
                        }">
                            {{ formatVotingTimerTime(votingLastSpeechTimerTimeLeft) }}
                        </div>
                        <div class="voting-timer-controls">
                            <button class="timer-btn timer-start"
                                    :disabled="votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused"
                                    @click.stop="playVotingLastSpeechTimer(); window.haptic.impact('light');"
                                    :title="votingLastSpeechTimerPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–°—Ç–∞—Ä—Ç'">
                                <i class="fa fa-play"></i>
                            </button>
                            <button class="timer-btn timer-pause"
                                    :disabled="!votingLastSpeechTimerRunning || votingLastSpeechTimerPaused"
                                    @click.stop="pauseVotingLastSpeechTimer(); window.haptic.impact('light');"
                                    title="–ü–∞—É–∑–∞">
                                <i class="fa fa-pause"></i>
                            </button>
                            <button class="timer-btn timer-stop"
                                    @click.stop="stopVotingLastSpeechTimer(); window.haptic.impact('light');"
                                    title="–°–±—Ä–æ—Å">
                                <i class="fa fa-stop"></i>
                            </button>
                        </div>
                        <div v-if="votingWinners.length > 1" class="voting-timer-nav">
                            <button class="glass-btn"
                                    :disabled="votingLastSpeechPlayerIndex <= 0"
                                    @click.stop="prevVotingLastSpeechPlayer(); window.haptic.impact('light');">
                                ‚óÄ –ü—Ä–µ–¥.
                            </button>
                            <span class="voting-timer-player-indicator">
                                {{ votingLastSpeechPlayerIndex + 1 }} / {{ votingWinners.length }}
                            </span>
                            <button class="glass-btn"
                                    :disabled="votingLastSpeechPlayerIndex >= votingWinners.length - 1"
                                    @click.stop="nextVotingLastSpeechPlayer(); window.haptic.impact('light');">
                                –°–ª–µ–¥. ‚ñ∂
                            </button>
                        </div>
                    </div>

                    <!-- –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
                    <button v-if="votingWinners && votingWinners.length"
                            class="glass-btn w-full btn-primary"
                            @click="closeVotingModalAndApplyResults(); window.haptic.notification('success');">
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
                    </button>

                    <!-- –ï—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª –≥–æ–ª–æ—Å–æ–≤ -->
                    <button v-else
                            class="glass-btn w-full btn-danger"
                            @click="closeVotingModalAndApplyResults(); window.haptic.notification('warning');">
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–Ω–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏)
                    </button>
                </div>
                <div class="voting-result">
                    <div v-if="votingWinners && votingWinners.length">
                        –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏: {{ votingWinners.join(', ') }}
                    </div>
                    <div v-else-if="votingStage !== 'main' && votingTiePlayers && votingTiePlayers.length > 1">
                        {{ votingStage === 'tie' ? '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ' : '–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –ø–æ–¥—ä–µ–º' }} —Å—Ä–µ–¥–∏: {{ votingTiePlayers.join(', ') }}
                    </div>
                    <div v-else>
                        –ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
        <div v-if="showVotingHistory" class="modal">
            <div class="modal-content">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</h2>

                <div v-if="votingHistory && votingHistory.length" class="w-100">
                    <!-- –í–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
                    <div class="voting-tabs-container">
                        <div class="voting-tabs">
                            <button
                                v-for="(voting, index) in votingHistory"
                                :key="'tab_' + index"
                                @click="activeVotingTab = index; window.haptic.selection();"
                                :class="['voting-tab', { 'active': activeVotingTab === index }]"
                            >
                                <span class="tab-title">#{{ voting.votingNumber }}</span>
                            </button>
                        </div>
                    </div>
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
                    <div class="modal-scroll" v-if="votingHistory[activeVotingTab]">
                        <div class="voting-session">
                            <h3 class="text-accent text-center mb-20">
                                –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ {{ votingHistory[activeVotingTab].votingNumber }}
                            </h3>

                            <!-- –°–ø–∏—Å–æ–∫ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ -->
                            <div v-if="votingHistory[activeVotingTab].nominees && votingHistory[activeVotingTab].nominees.length"
                                 class="voting-nominees-box">
                                <h4 class="text-accent font-bold" style="margin-bottom: 8px; font-size: 1em;">
                                    üìã –í—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã:
                                </h4>
                                <div style="color: #fff; font-size: 1.1em; font-weight: 500;">
                                    {{ votingHistory[activeVotingTab].nominees.join(', ') }}
                                </div>
                            </div>

                            <!-- –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —ç—Ç–∞–ø—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
                            <div v-for="(stage, stageIndex) in votingHistory[activeVotingTab].stages" :key="'stage_' + stageIndex" class="voting-stage">
                                <h4 class="text-secondary font-bold" style="font-size: 1.2em; margin-bottom: 15px; display: flex; align-items: center;">
                                    <span style="margin-right: 10px;">{{ stage.stageName }}</span>
                                    <span style="background: rgba(174,140,255,0.3); padding: 4px 8px; border-radius: 12px; font-size: 0.8em;">
                                        –≠—Ç–∞–ø {{ stageIndex + 1 }}
                                    </span>
                                </h4>

                                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (–¥–ª—è main –∏ tie) -->
                                <div v-if="stage.type !== 'lift'" style="margin-left: 10px;">
                                    <div v-for="candidate in stage.order" :key="'candidate_' + candidate" style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <strong class="text-accent" style="font-size: 1.1em;">–ò–≥—Ä–æ–∫ ‚Ññ{{ candidate }}</strong>
                                            <span style="background: rgba(174,140,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 0.9em; color: white;">
                                                {{ stage.results[candidate] ? stage.results[candidate].length : 0 }} –≥–æ–ª–æ—Å–æ–≤
                                            </span>
                                        </div>
                                        <div style="color: #fff; font-size: 0.95em;">
                                            <span class="text-secondary">–ì–æ–ª–æ—Å–æ–≤–∞–ª–∏:</span>
                                            {{ stage.results[candidate] && stage.results[candidate].length ? stage.results[candidate].join(', ') : '–ù–∏–∫—Ç–æ' }}
                                        </div>
                                        <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–±–µ–¥–∏–ª –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ -->
                                        <div v-if="stage.winners && stage.winners.includes(candidate)" style="margin-top: 8px; color: var(--status-success); font-weight: 600; font-size: 0.9em;">
                                            ‚úì –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫
                                        </div>
                                    </div>
                                </div>

                                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ –ø–æ–¥—ä–µ–º -->
                                <div v-else style="margin-left: 10px;">
                                    <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <strong class="text-accent" style="font-size: 1.1em;">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –ø–æ–¥—ä–µ–º</strong>
                                            <span style="background: rgba(174,140,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 0.9em; color: white;">
                                                {{ stage.liftResults ? stage.liftResults.length : 0 }} –≥–æ–ª–æ—Å–æ–≤
                                            </span>
                                        </div>
                                        <div style="color: #fff; font-size: 0.95em;">
                                            <span class="text-secondary">–ó–∞ –ø–æ–¥—ä–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏:</span>
                                            {{ stage.liftResults && stage.liftResults.length ? stage.liftResults.join(', ') : '–ù–∏–∫—Ç–æ' }}
                                        </div>
                                        <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ –ø–æ–¥—ä–µ–º -->
                                        <div v-if="stage.winners && stage.winners.length" style="margin-top: 8px; color: var(--status-success); font-weight: 600; font-size: 0.9em;">
                                            ‚úì –ò–≥—Ä–æ–∫–∏ {{ stage.order.join(', ') }} –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã
                                        </div>
                                        <div v-else style="margin-top: 8px; color: var(--status-error); font-weight: 600; font-size: 0.9em;">
                                            ‚úó –ò–≥—Ä–æ–∫–∏ {{ stage.order.join(', ') }} –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∏–≥—Ä–µ
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
                            <div :class="['final-result', (votingHistory[activeVotingTab].finalWinners && votingHistory[activeVotingTab].finalWinners.length) ? 'result-success' : 'result-error']">
                                <h4>
                                    üèÜ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
                                </h4>
                                <div v-if="votingHistory[activeVotingTab].finalWinners && votingHistory[activeVotingTab].finalWinners.length"
                                     style="color: #fff; font-weight: 600; font-size: 1.1em;">
                                    –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã –∏–≥—Ä–æ–∫–∏: {{ votingHistory[activeVotingTab].finalWinners.join(', ') }}
                                </div>
                                <div v-else style="color: #fff; font-weight: 600; font-size: 1.1em;">
                                    –ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else class="text-center text-secondary" style="padding: 40px;">
                    <div style="font-size: 3em; margin-bottom: 15px; opacity: 0.5;">üìã</div>
                    <div style="font-size: 1.2em;">–ò—Å—Ç–æ—Ä–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π –ø—É—Å—Ç–∞</div>
                    <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.7;">–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ, –∏ –æ–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
                <div class="modal-actions">
                    <button class="glass-btn btn-primary" @click="showVotingHistory = false">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ù–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é -->
    <div v-if="showMainMenu" id="main-nav-bar" class="main-nav-bar">
        <button class="nav-item" :class="{ active: activeHistoryTab === 'active' && !showProfileScreen && !showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = false; activeHistoryTab = 'active'; window.haptic.selection();">
            <i class="mdi mdi-play-circle-outline"></i>
            <span>–ê–∫—Ç–∏–≤–Ω—ã–µ</span>
        </button>
        <button class="nav-item" :class="{ active: activeHistoryTab === 'history' && !showProfileScreen && !showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = false; activeHistoryTab = 'history'; window.haptic.selection();">
            <i class="mdi mdi-history"></i>
            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
        <button class="nav-item nav-item--primary" @click="startNewGame(); window.haptic.impact('medium');">
            <i class="mdi mdi-plus"></i>
            <span>–ù–æ–≤–∞—è</span>
        </button>
        <button class="nav-item" :class="{ active: showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = true; window.haptic.impact('light');">
            <i class="mdi mdi-palette-outline"></i>
            <span>–¢–µ–º—ã</span>
        </button>
        <button class="nav-item" :class="{ active: showProfileScreen }" @click="showThemesScreen = false; showProfileScreen = true; window.haptic.impact('light');">
            <i class="mdi mdi-account-outline"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </div>

    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ (–¥–ª—è –∏–≥—Ä—ã) -->
    <div v-if="tableOut?.length && !winnerTeam" id="bottom-bar" class="glass-content glass-content--nav">
        <button :class="['glass-item', { 'glass-item--active': currentMode==='roles' }]" @click="setMode('roles'); window.haptic.selection();">
            <span>–†–æ–ª–∏</span>
        </button>
        <button :class="['glass-item', { 'glass-item--active': currentMode==='day' }]" @click="setMode('day'); window.haptic.selection();">
            <span>–î–µ–Ω—å</span>
        </button>
        <button :class="['glass-item', { 'glass-item--active': currentMode==='night' }]" @click="setMode('night'); window.haptic.selection();">
            <span>–ù–æ—á—å</span>
        </button>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script>
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö JS —Å cache-busting
[
    './voting.js',
    './timer.js',
    './session-manager.js',
    './app-connector.js',
    './app-data.js',
    './app-sessions.js',
    './app-game-logic.js',
    './app-ui-integration.js',
    './app-core.js',
    './assets/panel-notification.js'
].forEach(function(src) {
    document.write('<script src="' + src + '?v=' + window.__v + '"><\/script>');
});
</script>
<script>
// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ editVotingHistory –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º Vue-–∏–Ω—Å—Ç–∞–Ω—Å–µ
if (window.app && typeof window.app.editVotingHistory === 'undefined') {
    window.app.editVotingHistory = false;
}

if (window.app) {
  // –ó–∞–≥–ª—É—à–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
  window.app.showReturnPlayerModal = function(number, roleKey) {
    console.log('showReturnPlayerModal –æ—Ç–∫–ª—é—á–µ–Ω–æ');
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º
    this.showReturnPlayerModal = false;
  };
  window.app.confirmReturnPlayer = function() {
    console.log('confirmReturnPlayer –æ—Ç–∫–ª—é—á–µ–Ω–æ');
    this.showReturnPlayerModal = false;
  };
}

// –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp && window.app) {
    console.log('–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App');
    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    window.Telegram.WebApp.ready();
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    window.telegramApp = window.app;
}
</script>
</body>
</html>