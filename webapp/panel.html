<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Maf roles control panel</title>
    <script>
        // Cache-busting: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.__v = Date.now();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram WebApp
        window.addEventListener('error', (e) => {
            if (e.filename && e.filename.includes('telegram-web-app.js')) {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ Telegram WebApp —Å–∫—Ä–∏–ø—Ç–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è):', e.message);
                e.preventDefault();
            }
        });
    </script>
    <script src="https://telegram.org/js/telegram-web-app.js" onerror="console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram WebApp —Å–∫—Ä–∏–ø—Ç')"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script>
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö CSS —Å cache-busting
        [
            '../assets/font-akrobat/css.css',
            '../assets/flex.css',
            './styles-panel.css',
            './login/auth.css'
        ].forEach(function(href) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href + '?v=' + window.__v;
            document.head.appendChild(link);
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/7.2.96/css/materialdesignicons.min.css">
    
    <!-- –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∑—É–º–∞ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ Telegram Mini Apps -->
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å box-sizing –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ */
        *, *:before, *:after {
            box-sizing: border-box;
        }

        /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑—É–º–∞ –∏ –∂–µ—Å—Ç–æ–≤ */
        * {
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
        }
        
        /* –†–∞–∑—Ä–µ—à–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ input –ø–æ–ª—è—Ö */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }
        
        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ */
        body {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        /* Telegram Mini Apps —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .tg-app {
            height: 100vh; /* Fallback */
            height: var(--tg-viewport-height, 100vh);
            overflow: hidden;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ —É–±–∏—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        .player-inactive {
            pointer-events: auto;
            cursor: pointer;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }

        /* --- GRID DASHBOARD STYLES FOR SCORES --- */
        .scores-list {
            padding-bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            box-sizing: border-box;
            padding-top: 84px;
            padding-left: 16px;
            padding-right: 16px;
        }

        .score-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(16px) saturate(140%);
            -webkit-backdrop-filter: blur(16px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 22px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.1);
            width: 100%;
            position: relative;
        }

        .score-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 22px;
            background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
            opacity: 0.7;
        }

        .score-card.highlighted {
            background: rgba(174, 140, 255, 0.12);
            border-color: rgba(174, 140, 255, 0.35);
            box-shadow: 0 0 0 1px rgba(174,140,255,0.3), 0 8px 32px rgba(174,140,255,0.15);
            transform: scale(1.01);
            z-index: 10;
        }

        .score-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            background: transparent;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .score-card.highlighted .score-header {
            background: linear-gradient(90deg, rgba(174,140,255,0.08) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .score-content {
            padding: 12px;
            background: rgba(0,0,0,0.15);
            width: 100%;
            position: relative;
            z-index: 1;
        }

        /* GRID LAYOUT */
        .score-dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            width: 100%;
        }

        .dashboard-cell {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 80px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .dashboard-cell::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
            opacity: 0.5;
        }

        .dashboard-cell.full-width {
            grid-column: 1 / -1;
            min-height: auto;
        }

        .cell-label {
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: space-between;
            white-space: nowrap;
        }

        /* Opinion & Protocol Lists */
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
            width: 100%;
        }

        .info-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85em;
            padding: 4px 8px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            width: 100%;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .info-text-mini {
            font-size: 0.9em;
            font-style: italic;
            color: #ccc;
            line-height: 1.4;
            padding: 4px;
            word-wrap: break-word;
        }

        /* Inputs */
        .math-input-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .math-input {
            width: 100%;
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.08);
            color: #fff;
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.2em;
            font-weight: bold;
            outline: none;
            transition: all 0.2s;
            min-width: 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .math-input:focus {
            border-color: var(--maf-accent-color);
            background: rgba(0,0,0,0.35);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 0 2px var(--maf-accent-color);
        }

        .math-input.positive { color: #30d158; }
        .math-input.negative { color: #ff453a; }

        /* Status & Total */
        .status-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .total-content {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100%;
        }

        .total-value {
            font-size: 2em;
            font-weight: 800;
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #fff 0%, var(--maf-accent-color, #ae8cff) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            filter: drop-shadow(0 0 8px rgba(174,140,255,0.2));
        }

        .win-badge {
            font-size: 0.7em;
            background: rgba(255, 214, 10, 0.12);
            color: #ffd60a;
            padding: 3px 8px;
            border-radius: 8px;
            margin-top: 4px;
            white-space: nowrap;
            border: 1px solid rgba(255,214,10,0.15);
        }

        /* Common Elements */
        .role-tag {
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 0.75em;
            margin-left: 10px;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            backdrop-filter: blur(4px);
        }

        .role-tag.peace { background: rgba(30,58,138,0.6); color: #90caf9; border: 1px solid rgba(144, 202, 249, 0.15); }
        .role-tag.sheriff { background: rgba(66,54,2,0.6); color: #ffd54f; border: 1px solid rgba(255, 213, 79, 0.15); }
        .role-tag.mafia { background: rgba(62,26,26,0.6); color: #ef9a9a; border: 1px solid rgba(239, 154, 154, 0.15); }
        .role-tag.don { background: rgba(74,20,140,0.6); color: #e1bee7; border: 1px solid rgba(225, 190, 231, 0.15); }

        .player-num-badge {
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9em;
            color: #aaa;
            flex-shrink: 0;
        }

        .score-card.highlighted .player-num-badge {
            background: var(--maf-accent-color);
            color: #000;
        }

        .check-icon { color: #30d158; margin-left: 4px; }
        .cross-icon { color: #ff453a; margin-left: 4px; }

        .self-kill-status {
            color: #ff453a;
            font-weight: bold;
            font-size: 0.85em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(255, 69, 58, 0.5);
            animation: pulse-red 2s infinite;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: 100%;
        }

        @keyframes pulse-red {
            0% { text-shadow: 0 0 5px rgba(255, 69, 58, 0.3); opacity: 0.8; }
            50% { text-shadow: 0 0 15px rgba(255, 69, 58, 0.7); opacity: 1; }
            100% { text-shadow: 0 0 5px rgba(255, 69, 58, 0.3); opacity: 0.8; }
        }

        .empty-data {
            font-size: 0.8em;
            color: rgba(255,255,255,0.25);
            text-align: center;
            margin-top: auto;
            margin-bottom: auto;
        }

        /* --- REVEAL BUTTON STYLE --- */
        .reveal-btn {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255,255,255,0.6);
            padding: 6px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 60px;
            text-align: center;
            outline: none;
        }

        .reveal-btn:active {
            transform: scale(0.92);
        }

        .reveal-btn.active {
            background: rgba(48, 209, 88, 0.15);
            border-color: rgba(48,209,88,0.35);
            color: #30d158;
            box-shadow: 0 0 12px rgba(48, 209, 88, 0.15);
        }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 380px) {
            .score-content {
                padding: 8px;
            }
            .score-dashboard-grid {
                gap: 6px;
            }
            .dashboard-cell {
                padding: 8px 6px;
                min-height: 70px;
            }
            .cell-label {
                font-size: 0.65em;
                margin-bottom: 6px;
            }
            .math-input {
                font-size: 1em;
                padding: 6px;
            }
            .total-value {
                font-size: 1.6em;
            }
            .role-tag {
                margin-left: 6px;
                padding: 2px 6px;
                font-size: 0.7em;
            }
            .info-item {
                font-size: 0.8em;
                padding: 3px 6px;
            }
            .reveal-btn {
                padding: 4px 10px;
                font-size: 0.85em;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp) {
    const tg = window.Telegram.WebApp;
    
    // 1. –ë–∞–∑–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π)
    tg.expand();
    
    // 2. –ü–æ–ø—ã—Ç–∫–∞ –≤–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (Bot API 8.0+)
    if (typeof tg.requestFullscreen === 'function') {
        tg.requestFullscreen();
    }
    
    // 3. –û—Ç–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
    if (typeof tg.disableVerticalSwipes === 'function') {
        tg.disableVerticalSwipes();
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ö–µ–¥–µ—Ä–∞ –∏ —Ñ–æ–Ω–∞
    tg.setHeaderColor('#0c0a1e');
    tg.setBackgroundColor('#0c0a1e');

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.body.classList.add('tg-app');
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –≤—å—é–ø–æ—Ä—Ç–∞
    function updateViewportHeight() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º tg.viewportStableHeight –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ, –∏–Ω–∞—á–µ viewportHeight
        const vh = tg.viewportStableHeight || tg.viewportHeight;
        if (vh) {
            document.documentElement.style.setProperty('--tg-viewport-height', `${vh}px`);
        }
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—å—é–ø–æ—Ä—Ç–∞
    tg.onEvent('viewportChanged', updateViewportHeight);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    updateViewportHeight();
    setTimeout(updateViewportHeight, 100);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
    tg.ready();
    
    // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
    tg.enableClosingConfirmation();
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
    window.haptic = {
        impact: (style = 'light') => {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred(style);
        },
        notification: (type = 'success') => {
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred(type);
        },
        selection: () => {
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        }
    };
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
    window.sessionManager = {
        // –ö–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        SESSION_KEY: 'maf_panel_session_data',
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        saveSession: function(data) {
            try {
                const sessionData = {
                    ...data,
                    timestamp: Date.now()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem(this.SESSION_KEY, JSON.stringify(sessionData));
                
                // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Telegram CloudStorage –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                if (tg.CloudStorage) {
                    tg.CloudStorage.setItem(this.SESSION_KEY, JSON.stringify(sessionData));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
            }
        },
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏
        getSession: function() {
            try {
                const localData = localStorage.getItem(this.SESSION_KEY);
                if (localData) {
                    return JSON.parse(localData);
                }
                return null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–∏:', error);
                return null;
            }
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏ (3 —á–∞—Å–∞)
        isSessionValid: function(sessionData) {
            if (!sessionData || !sessionData.timestamp) {
                return false;
            }
            
            const now = Date.now();
            const sessionTime = sessionData.timestamp;
            const threeHours = 3 * 60 * 60 * 1000; // 3 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
            
            return (now - sessionTime) < threeHours;
        },
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –∑–Ω–∞—á–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏
        hasSignificantData: function(sessionData) {
            if (!sessionData) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –∫–æ–º–Ω–∞—Ç–∞ –ò (—Ç—É—Ä–Ω–∏—Ä –ò–õ–ò —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º —Å –∏–≥—Ä–æ–∫–∞–º–∏)
            return sessionData.roomId && (
                sessionData.tournamentId || 
                (sessionData.manualMode && sessionData.manualPlayers && sessionData.manualPlayers.length > 0)
            );
        },
        
        // –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
        clearSession: function() {
            try {
                localStorage.removeItem(this.SESSION_KEY);
                if (tg.CloudStorage) {
                    tg.CloudStorage.removeItem(this.SESSION_KEY);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Å—Å–∏–∏:', error);
            }
        }
    };
} else {
    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è haptic, –µ—Å–ª–∏ –Ω–µ –≤ Telegram
    window.haptic = {
        impact: () => {},
        notification: () => {},
        selection: () => {}
    };
}
</script>
<script>
// ‚îÄ‚îÄ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ ‚îÄ‚îÄ
// –ï—Å–ª–∏ –ø–∞–ª–µ—Ü —Å–¥–≤–∏–Ω—É–ª—Å—è –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 10px ‚Äî —ç—Ç–æ —Å–∫—Ä–æ–ª–ª, –∞ –Ω–µ —Ç–∞–ø.
// –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ–¥–∞–≤–ª—è–µ–º click-—Å–æ–±—ã—Ç–∏–µ, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏.
(function() {
    var SCROLL_THRESHOLD = 10; // px ‚Äî –ø–æ—Ä–æ–≥ —Å–º–µ—â–µ–Ω–∏—è, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—á–∏—Ç–∞–µ–º –∂–µ—Å—Ç —Å–∫—Ä–æ–ª–ª–æ–º
    var touchStartX = 0;
    var touchStartY = 0;
    var isScrolling = false;

    document.addEventListener('touchstart', function(e) {
        var touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
        isScrolling = false;
    }, { passive: true });

    document.addEventListener('touchmove', function(e) {
        if (isScrolling) return;
        var touch = e.touches[0];
        var dx = Math.abs(touch.clientX - touchStartX);
        var dy = Math.abs(touch.clientY - touchStartY);
        if (dx > SCROLL_THRESHOLD || dy > SCROLL_THRESHOLD) {
            isScrolling = true;
        }
    }, { passive: true });

    document.addEventListener('click', function(e) {
        if (isScrolling) {
            e.preventDefault();
            e.stopPropagation();
            isScrolling = false;
        }
    }, true); // capturing phase ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ Vue –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç
})();
</script>
<script>document.write('<script src="./login/auth.js?v=' + window.__v + '"><\/script>');</script>
<div id="app" :class="{ 'obs-cef': isObs }">
    <!-- –ë–∞–Ω–Ω–µ—Ä –æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ -->
    <div v-if="!isActivePanel && activePanelId && roomId" class="top-banner">
        <b>–í–Ω–∏–º–∞–Ω–∏–µ!</b> –í —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å.<br>
        <button @click="activateThisPanel(); window.haptic.impact('medium');">
            –°–¥–µ–ª–∞—Ç—å —ç—Ç—É –ø–∞–Ω–µ–ª—å –≥–ª–∞–≤–Ω–æ–π
        </button>
    </div>
    
    <div :class="{ 'content-shifted': (!isActivePanel && activePanelId && roomId) }">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–≥—Ä (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å) -->
        <div v-if="showMainMenu" class="main-menu-screen">
            <div class="main-menu-container">
                <div class="main-menu-header">
                    <div class="main-menu-logo">
                        <i class="mdi mdi-cards-playing-outline"></i>
                    </div>
                    <h1 class="main-menu-title">MafBoard</h1>
                    <p class="main-menu-subtitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ñ–∏–µ–π</p>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä -->
                <div v-if="sessionsList && sessionsList.length > 0" class="main-menu-history">
                    <div class="main-menu-history-title">
                        <i class="fa fa-history" style="margin-right: 6px; opacity: 0.6;"></i>
                        {{ activeHistoryTab === 'active' ? '–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã' : '–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä' }}
                        <span class="main-menu-history-count">
                            {{ activeHistoryTab === 'active' ? getActiveSessions().length : getHistorySessions().length }}
                        </span>
                    </div>

                    <div class="main-menu-sessions-list">
                        <template v-for="group in (activeHistoryTab === 'active' ? getGroupedActiveSessions() : getGroupedHistorySessions())">

                            <!-- –¢—É—Ä–Ω–∏—Ä–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (–≥—Ä—É–ø–ø–∞) -->
                            <div v-if="group.isTournament" :key="'tg-'+group.tournamentId" class="tournament-group-card">
                                <div class="tournament-group-header" @click="toggleTournamentExpanded(group.tournamentId); window.haptic.selection();">
                                    <div class="tournament-group-icon">
                                        <i :class="group.tournamentId && group.tournamentId.toString().startsWith('funky_') ? 'mdi mdi-cards-playing-outline' : 'mdi mdi-trophy-outline'"></i>
                                    </div>
                                    <div class="tournament-group-info">
                                        <div class="tournament-group-name">{{ group.tournamentName }}</div>
                                        <div class="tournament-group-meta">
                                            <span class="tournament-game-count">{{ group.finishedGamesCount }}/{{ group.gamesCount }} {{ group.gamesCount === 1 ? '–∏–≥—Ä–∞' : (group.gamesCount < 5 ? '–∏–≥—Ä—ã' : '–∏–≥—Ä') }}</span>
                                            <span v-if="group.hasActiveGame" class="tournament-status-badge active">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                                            <span v-else-if="group.allGamesFinished && activeHistoryTab === 'active'" class="tournament-status-badge ready">–í—Å–µ –∏–≥—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã</span>
                                        </div>
                                    </div>
                                    <div class="tournament-group-chevron" :class="{ expanded: isTournamentExpanded(group.tournamentId) }">
                                        <i class="mdi mdi-chevron-down"></i>
                                    </div>
                                </div>

                                <!-- –†–∞—Å–∫—Ä—ã—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç—É—Ä–Ω–∏—Ä–∞ -->
                                <div v-if="isTournamentExpanded(group.tournamentId)" class="tournament-group-body">
                                    <div class="tournament-games-list">
                                        <div v-for="session in group.sessions" :key="session.sessionId"
                                             class="tournament-game-row"
                                             :class="{ finished: !!session.winnerTeam, active: !session.winnerTeam }"
                                             @click="openSession(session.sessionId); window.haptic.impact('light');">
                                            <div class="tournament-game-num">
                                                <span class="game-num-label">–ò–≥—Ä–∞ {{ session.gameSelected || '?' }}</span>
                                                <span v-if="session.tableSelected" class="game-table-label">–°—Ç–æ–ª {{ session.tableSelected }}</span>
                                            </div>
                                            <div class="tournament-game-result">
                                                {{ getGameResultText(session) }}
                                            </div>
                                            <div class="tournament-game-time">
                                                {{ formatSessionTime(session.timestamp) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Ç—É—Ä–Ω–∏—Ä–∞ -->
                                    <div class="tournament-actions" v-if="activeHistoryTab === 'active'">
                                        <button class="tournament-action-btn next-game-btn"
                                                @click.stop="startNextTournamentGame(group.tournamentId, group.sessions[group.sessions.length - 1].tableSelected || 1); window.haptic.impact('medium');">
                                            <i class="mdi mdi-plus-circle-outline" style="margin-right: 6px;"></i>
                                            –ù–æ–≤–∞—è –∏–≥—Ä–∞
                                        </button>
                                        <button class="tournament-action-btn summary-btn"
                                                @click.stop="funkyBuildSummary(group.tournamentId); window.haptic.impact('medium');">
                                            <i class="mdi mdi-chart-bar" style="margin-right: 6px;"></i>
                                            –ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏
                                        </button>
                                        <button class="tournament-action-btn finish-tournament-btn"
                                                @click.stop="finishTournament(group.tournamentId); window.haptic.notification('success');">
                                            <i class="mdi mdi-flag-checkered" style="margin-right: 6px;"></i>
                                            –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
                                        </button>
                                    </div>
                                    <!-- –ö–Ω–æ–ø–∫–∞ –∏—Ç–æ–≥–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏ -->
                                    <div class="tournament-actions" v-if="activeHistoryTab === 'history'">
                                        <button class="tournament-action-btn summary-btn"
                                                @click.stop="funkyBuildSummary(group.tournamentId); window.haptic.impact('medium');">
                                            <i class="mdi mdi-chart-bar" style="margin-right: 6px;"></i>
                                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- –û–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (–Ω–µ —Ç—É—Ä–Ω–∏—Ä) -->
                            <div v-else :key="group.sessions[0].sessionId"
                                 class="main-menu-session-card"
                                 @click="openSession(group.sessions[0].sessionId); window.haptic.impact('light');">

                                <div class="session-card-header">
                                    <div class="session-card-name">{{ getSessionDisplayName(group.sessions[0]) }}</div>
                                    <div class="session-card-time">{{ formatSessionTime(group.sessions[0].timestamp) }}</div>
                                </div>

                                <div class="session-card-details">
                                    <span class="session-card-status">{{ getSessionStatusText(group.sessions[0]) }}</span>
                                    <span v-if="getSessionModeText(group.sessions[0])" class="session-card-mode">{{ getSessionModeText(group.sessions[0]) }}</span>
                                    <span class="session-card-room">{{ getSessionRoomText(group.sessions[0]) }}</span>
                                </div>

                                <button v-if="activeHistoryTab === 'active'" class="session-card-delete"
                                        @click.stop="deleteSession(group.sessions[0].sessionId); window.haptic.impact('light');"
                                        title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </template>

                        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏ -->
                        <div v-if="(activeHistoryTab === 'active' ? getGroupedActiveSessions() : getGroupedHistorySessions()).length === 0" class="main-menu-empty-tab">
                            <div class="main-menu-empty-text">–ù–µ—Ç {{ activeHistoryTab === 'active' ? '–∞–∫—Ç–∏–≤–Ω—ã—Ö' : '–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö' }} –∏–≥—Ä</div>
                        </div>
                    </div>
                </div>

                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–µ—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç —Å–µ—Å—Å–∏–π) -->
                <div v-else class="main-menu-empty">
                    <div class="main-menu-empty-icon">üé≤</div>
                    <div class="main-menu-empty-text">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏–≥—Ä</div>
                    <div class="main-menu-empty-hint">
                        –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É ‚Äî –æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ü—Ä–æ—Ñ–∏–ª—å (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showProfileScreen" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <h1 class="fullscreen-page-title">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                </div>

                <div class="profile-avatar-section">
                    <div class="profile-avatar" :style="judgeAvatarUrl ? {backgroundImage: 'url(' + judgeAvatarUrl + ')'} : {}">
                        <i v-if="!judgeAvatarUrl" class="fa fa-user profile-avatar-placeholder"></i>
                    </div>
                    <div class="profile-avatar-hint">–ê–≤–∞—Ç–∞—Ä –∏–∑ Telegram</div>
                </div>

                <div class="profile-field">
                    <label class="profile-field-label">–ù–∏–∫–Ω–µ–π–º</label>
                    <input type="text" class="profile-field-input" v-model="judgeNickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="50">
                    <div class="profile-field-hint">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã –≤ –¢–µ–ª–µ–≥—Ä–∞–º</div>
                </div>

                <button class="glass-btn w-full btn-primary mt-20" @click="saveJudgeNickname(); window.haptic.notification('success');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¢–µ–º—ã (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showThemesScreen" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <h1 class="fullscreen-page-title">–¢–µ–º—ã</h1>
                </div>

                <div class="text-center text-secondary font-bold text-large mb-10" style="letter-spacing:.02em;">
                    {{ colorSchemes.find(s=>s.key===selectedColorScheme)?.name || '' }}
                </div>
                <div class="theme-grid">
                    <div v-for="scheme in colorSchemes"
                         :key="scheme.key"
                         :title="scheme.name"
                         class="theme-preview-item"
                         @click="applyColorSchemeGlobal(scheme.key); window.haptic.selection();"
                         :style="{
                            border: selectedColorScheme === scheme.key ? '4px solid #fff' : '2px solid var(--maf-accent-color)',
                            background: scheme.preview,
                            outline: selectedColorScheme === scheme.key ? '3px solid ' + scheme.accent : 'none',
                            outlineOffset: selectedColorScheme === scheme.key ? '2px' : '0'
                         }">
                        <span>{{scheme.icon || '‚òÖ'}}</span>
                        <span v-if="selectedColorScheme === scheme.key" class="check">‚úî</span>
                    </div>
                </div>

                <div class="text-center text-secondary font-bold text-large" style="margin:24px 0 12px 0;">
                    –§–æ–Ω –ø–∞–Ω–µ–ª–∏
                </div>
                <div class="theme-grid">
                    <div v-for="theme in backgroundThemes"
                         :key="theme.key"
                         :title="theme.name"
                         class="theme-preview-item"
                         @click="applyBackgroundThemeGlobal(theme.key); window.haptic.selection();"
                         :style="{
                            border: selectedBackgroundTheme === theme.key ? '4px solid #fff' : '2px solid var(--maf-accent-color)',
                            background: theme.bgMain,
                            outline: selectedBackgroundTheme === theme.key ? '3px solid var(--maf-accent-color)' : 'none',
                            outlineOffset: selectedBackgroundTheme === theme.key ? '2px' : '0'
                         }">
                        <span>{{theme.icon}}</span>
                        <span v-if="selectedBackgroundTheme === theme.key" class="check">‚úî</span>
                    </div>
                </div>

                <button class="theme-save-btn" @click="showThemesScreen = false; activeHistoryTab = 'active'; window.haptic.notification('success');">
                    <i class="mdi mdi-check-circle-outline" style="margin-right: 8px; font-size: 1.2em;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- ============ –≠–ö–†–ê–ù –ù–û–í–û–ô –ò–ì–†–´ (–µ–¥–∏–Ω—ã–π) ============ -->
        <div v-if="showModal && !showMainMenu && !showGameTableModal" class="modal">
            <div class="modal-content ng-modal-content">

                <!-- ‚îÄ‚îÄ‚îÄ –®–∞–≥ 1: –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ ‚îÄ‚îÄ‚îÄ -->
                <template v-if="newGameStep === 'modes'">
                    <h2>–ù–æ–≤–∞—è –∏–≥—Ä–∞</h2>

                    <div class="ng-cards">
                        <!-- GoMafia -->
                        <div class="ng-card" @click="newGameStep = 'gomafia'; window.haptic.selection();">
                            <img class="ng-card-icon" src="./icon/gomafia.png" alt="GoMafia" />
                            <div class="ng-card-body">
                                <div class="ng-card-title">GoMafia</div>
                                <div class="ng-card-desc">–¢—É—Ä–Ω–∏—Ä–Ω—ã–π —Ä–µ–∂–∏–º</div>
                            </div>
                            <i class="mdi mdi-chevron-right ng-card-arrow"></i>
                        </div>

                        <!-- Go–†—É—á–∫–∞–º–∏ (—Å–∫–æ—Ä–æ) -->
                        <div class="ng-card ng-card-soon">
                            <img class="ng-card-icon" src="./icon/goruchkami.png" alt="Go–†—É—á–∫–∞–º–∏" />
                            <div class="ng-card-body">
                                <div class="ng-card-title">Go–†—É—á–∫–∞–º–∏</div>
                                <div class="ng-card-desc">–†—É—á–Ω–∞—è —Ä–∞—Å—Å–∞–¥–∫–∞</div>
                            </div>
                            <span class="ng-soon-badge">—Å–∫–æ—Ä–æ</span>
                        </div>

                        <!-- –ö–ª—É–±–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (—Å–∫–æ—Ä–æ) -->
                        <div class="ng-card ng-card-soon">
                            <div class="ng-card-icon-placeholder"><i class="mdi mdi-trophy-variant-outline"></i></div>
                            <div class="ng-card-body">
                                <div class="ng-card-title">–ö–ª—É–±–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                                <div class="ng-card-desc">–ö–ª—É–±–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã</div>
                            </div>
                            <span class="ng-soon-badge">—Å–∫–æ—Ä–æ</span>
                        </div>

                        <!-- –§–∞–Ω–∫–∏ -->
                        <div class="ng-card" @click="startFunkyMode(); window.haptic.impact('medium');">
                            <div class="ng-card-icon-placeholder"><i class="mdi mdi-cards-playing-outline"></i></div>
                            <div class="ng-card-body">
                                <div class="ng-card-title">–§–∞–Ω–∫–∏</div>
                                <div class="ng-card-desc">–°–≤–æ–±–æ–¥–Ω–∞—è –∏–≥—Ä–∞</div>
                            </div>
                            <i class="mdi mdi-chevron-right ng-card-arrow"></i>
                        </div>
                    </div>

                    <button class="glass-btn w-full mt-16" style="opacity: 0.5; font-size: 0.9em;" @click="showModal = false; returnToMainMenu(); window.haptic.impact('light');">
                        <i class="fa fa-arrow-left" style="margin-right:8px;"></i>
                        –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                    </button>
                </template>

                <!-- ‚îÄ‚îÄ‚îÄ –®–∞–≥ 2: GoMafia ‚Äî –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ ‚îÄ‚îÄ‚îÄ -->
                <template v-if="newGameStep === 'gomafia'">
                    <div class="ng-step-header">
                        <img src="./icon/gomafia.png" alt="GoMafia" class="ng-step-logo" />
                        <div>
                            <h2 class="ng-step-title">GoMafia</h2>
                            <div class="ng-step-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä–Ω–∏—Ä</div>
                        </div>
                    </div>

                    <div class="ng-cards">
                        <!-- –í—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ -->
                        <div class="ng-card" @click="openTournamentBrowser(); window.haptic.impact('medium');">
                            <div class="ng-card-icon-placeholder" style="background: rgba(174,140,255,0.12);"><i class="mdi mdi-format-list-bulleted" style="color: var(--accent-color);"></i></div>
                            <div class="ng-card-body">
                                <div class="ng-card-title">–í—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞</div>
                                <div class="ng-card-desc">–¢—É—Ä–Ω–∏—Ä—ã —Å gomafia.pro</div>
                            </div>
                            <i class="mdi mdi-chevron-right ng-card-arrow"></i>
                        </div>

                        <!-- –í–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä -->
                        <div class="ng-id-input-card">
                            <div class="ng-id-row">
                                <div class="ng-card-icon-placeholder" style="background: rgba(255,215,0,0.1);"><i class="mdi mdi-trophy-outline" style="color: #ffd700;"></i></div>
                                <input
                                    type="text"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                    v-model="tournamentId"
                                    placeholder="–ù–æ–º–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞"
                                    class="ng-id-input"
                                    @keydown.enter="loadTournament(); window.haptic.impact('medium');"
                                    @input="tournamentId = tournamentId.replace(/[^0-9]/g, '')"
                                >
                            </div>
                            <button class="glass-btn w-full btn-primary ng-load-btn" :disabled="!tournamentId" @click="loadTournament(); window.haptic.impact('medium');">
                                <i class="mdi mdi-download" style="margin-right:6px;"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
                            </button>
                        </div>
                    </div>

                    <button class="glass-btn w-full mt-16" style="opacity: 0.5; font-size: 0.9em;" @click="newGameStep = 'modes'; window.haptic.impact('light');">
                        <i class="fa fa-arrow-left" style="margin-right:8px;"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                </template>

                <!-- ‚îÄ‚îÄ‚îÄ –®–∞–≥ –§–∞–Ω–∫–∏: –≤–≤–æ–¥ –∏–≥—Ä–æ–∫–æ–≤ ‚îÄ‚îÄ‚îÄ -->
                <template v-if="newGameStep === 'funky'">
                    <div class="ng-step-header">
                        <div class="ng-card-icon-placeholder" style="background: rgba(174,140,255,0.12); width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                            <i class="mdi mdi-cards-playing-outline" style="color: var(--maf-accent-color, #ae8cff); font-size:1.3em;"></i>
                        </div>
                        <div>
                            <h2 class="ng-step-title">–§–∞–Ω–∫–∏</h2>
                            <div class="ng-step-subtitle">{{ mainInfoText }} ¬∑ –ò–≥—Ä–∞ {{ funkyGameNumber }}</div>
                        </div>
                    </div>

                    <div class="funky-players-list">
                        <div v-for="(player, index) in funkyPlayers" :key="'fp-'+index" class="funky-player-slot" :class="{ filled: player !== null }">
                            <div class="funky-player-num">{{ index + 1 }}</div>

                            <div class="funky-player-input-wrap" v-if="player === null">
                                <input
                                    type="text"
                                    class="funky-player-input"
                                    :data-index="index"
                                    :value="funkyPlayerInputs[index]"
                                    :placeholder="'–ò–≥—Ä–æ–∫ ' + (index + 1)"
                                    @input="$set(funkyPlayerInputs, index, $event.target.value); funkyOnInput(index)"
                                    @focus="funkyActiveInput = index"
                                    @keydown.enter="funkySetManualPlayer(index)"
                                    autocomplete="off"
                                >
                                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                                <div v-if="funkyActiveInput === index && funkySearchLoading" class="funky-search-loading">
                                    <i class="mdi mdi-loading mdi-spin"></i> –ü–æ–∏—Å–∫...
                                </div>
                                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                                <div v-if="funkyActiveInput === index && funkySearchResults.length > 0 && !funkySearchLoading" class="funky-search-dropdown">
                                    <div v-for="result in funkySearchResults" :key="result.login"
                                         class="funky-search-item"
                                         @mousedown.prevent="funkySelectPlayer(index, result); window.haptic && window.haptic.selection();"
                                         @touchstart.prevent="funkySelectPlayer(index, result); window.haptic && window.haptic.selection();">
                                        <div class="funky-search-avatar" :style="result.avatar_link ? {backgroundImage: 'url(' + result.avatar_link + ')'} : {}">
                                            <i v-if="!result.avatar_link" class="mdi mdi-account" style="opacity:0.4;"></i>
                                        </div>
                                        <div class="funky-search-info">
                                            <div class="funky-search-name">{{ result.login }}</div>
                                            <div v-if="result.title" class="funky-search-title">{{ result.title }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫ -->
                            <div class="funky-player-selected" v-else>
                                <div class="funky-selected-avatar" :style="player.avatar_link ? {backgroundImage: 'url(' + player.avatar_link + ')'} : {}">
                                    <i v-if="!player.avatar_link" class="mdi mdi-account" style="opacity:0.4; font-size:1.2em;"></i>
                                </div>
                                <div class="funky-selected-name">{{ player.login }}</div>
                                <button class="funky-clear-btn" @click.stop="funkyClearPlayer(index); window.haptic.impact('light');">
                                    <i class="mdi mdi-close"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="funky-filled-counter">
                        {{ funkyPlayers.filter(p => p !== null).length }} / 10 –∏–≥—Ä–æ–∫–æ–≤
                    </div>

                    <div class="funky-actions-container">
                        <button class="glass-btn funky-shuffle-btn"
                                :disabled="!funkyAllPlayersFilled()"
                                @click="funkyShufflePlayers(); window.haptic.impact('medium');">
                            <i class="mdi mdi-shuffle-variant" style="margin-right:8px;"></i>
                            –†–∞—Å—Å–∞–¥–∏—Ç—å
                        </button>
                        <div class="game-actions-row">
                            <button class="glass-btn funky-back-btn" @click="newGameStep = 'modes'; returnToMainMenu(); window.haptic.impact('light');">
                                <i class="fa fa-arrow-left" style="margin-right:6px;"></i>
                                <span>–ù–∞–∑–∞–¥</span>
                            </button>
                            <button class="glass-btn game-finish-btn"
                                    :disabled="!funkyAllPlayersFilled()"
                                    @click="funkyConfirmPlayers(); window.haptic.notification('success');">
                                <i class="mdi mdi-check-circle-outline" style="margin-right:6px;"></i>
                                <span>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</span>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- ============ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø–∏—Å–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤ GoMafia ============ -->
        <div v-if="showTournamentBrowser" class="modal tb-modal">
            <div class="modal-content tb-modal-content">

                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="tb-header">
                    <div class="tb-header-icon">
                        <img src="./icon/gomafia.png" alt="GoMafia" />
                    </div>
                    <div class="tb-header-text">
                        <h2 class="tb-title">–¢—É—Ä–Ω–∏—Ä—ã</h2>
                        <div class="tb-subtitle">gomafia.pro</div>
                    </div>
                </div>

                <!-- –ü–æ–∏—Å–∫ -->
                <div class="tb-search-wrap">
                    <i class="fa fa-search tb-search-icon"></i>
                    <input
                        class="tb-search-input"
                        type="text"
                        placeholder="–ü–æ–∏—Å–∫ —Ç—É—Ä–Ω–∏—Ä–∞..."
                        :value="tournamentsFilters.search"
                        @input="onTournamentSearchInput($event.target.value)"
                    >
                    <button v-if="tournamentsFilters.search" class="tb-search-clear" @click="applyTournamentFilter('search', '')">
                        <i class="fa fa-times"></i>
                    </button>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div class="tb-filters">
                    <div class="tb-filter-row">
                        <div class="tb-chip" :class="{ active: !tournamentsFilters.period }" @click="applyTournamentFilter('period', ''); window.haptic.selection();">
                            <i class="mdi mdi-clock-outline"></i><span>–ë–ª–∏–∂–∞–π—à–∏–µ</span>
                        </div>
                        <div class="tb-chip" :class="{ active: tournamentsFilters.period === 'past' }" @click="applyTournamentFilter('period', 'past'); window.haptic.selection();">
                            <i class="mdi mdi-history"></i><span>–ü—Ä–æ—à–µ–¥—à–∏–µ</span>
                        </div>
                    </div>
                    <div class="tb-filter-row">
                        <div class="tb-chip" :class="{ active: !tournamentsFilters.type }" @click="applyTournamentFilter('type', ''); window.haptic.selection();"><span>–í—Å–µ</span></div>
                        <div class="tb-chip" :class="{ active: tournamentsFilters.type === 'offline' }" @click="applyTournamentFilter('type', 'offline'); window.haptic.selection();"><i class="mdi mdi-map-marker-outline"></i><span>–û—Ñ–ª–∞–π–Ω</span></div>
                        <div class="tb-chip" :class="{ active: tournamentsFilters.type === 'online' }" @click="applyTournamentFilter('type', 'online'); window.haptic.selection();"><i class="mdi mdi-wifi"></i><span>–û–Ω–ª–∞–π–Ω</span></div>
                        <div class="tb-chip tb-chip-star" :class="{ active: tournamentsFilters.fsm === 'fsm' }" @click="applyTournamentFilter('fsm', tournamentsFilters.fsm === 'fsm' ? '' : 'fsm'); window.haptic.selection();"><i class="mdi mdi-star-outline"></i><span>–§–°–ú</span></div>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤ -->
                <div class="tb-list-scroll">
                    <div v-if="tournamentsLoading && tournamentsList.length === 0" class="tb-state">
                        <div class="tb-spinner"></div>
                        <span>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤...</span>
                    </div>

                    <div v-else-if="tournamentsError" class="tb-state">
                        <i class="mdi mdi-alert-circle-outline" style="font-size: 2em; color: var(--status-error);"></i>
                        <span>{{ tournamentsError }}</span>
                        <button class="glass-btn btn-small mt-10" @click="fetchTournaments()"><i class="fa fa-redo" style="margin-right: 6px;"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>

                    <div v-else-if="!tournamentsLoading && tournamentsList.length === 0" class="tb-state">
                        <i class="mdi mdi-trophy-broken" style="font-size: 2em; opacity: 0.35;"></i>
                        <span>–¢—É—Ä–Ω–∏—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</span>
                    </div>

                    <template v-else>
                        <div class="tb-card"
                             v-for="(t, idx) in tournamentsList"
                             :key="t.id || t.tournamentId || idx"
                             :class="{ 'tb-card-disabled': !isTournamentSeatingReady(t) }"
                             @click="isTournamentSeatingReady(t) ? selectTournamentFromBrowser(t) : null; window.haptic.impact(isTournamentSeatingReady(t) ? 'medium' : 'light');">

                            <div class="tb-card-top">
                                <div class="tb-card-name">{{ t.name || t.title || ('–¢—É—Ä–Ω–∏—Ä #' + (t.id || t.tournamentId)) }}</div>
                                <!-- –ë–µ–π–¥–∂ —Ä–∞—Å—Å–∞–¥–∫–∏ -->
                                <div v-if="isTournamentSeatingReady(t)" class="tb-badge tb-badge-seating">
                                    <i class="mdi mdi-check-circle" style="margin-right:3px;"></i>–†–∞—Å—Å–∞–¥–∫–∞
                                </div>
                                <div v-else class="tb-badge tb-badge-no-seating">
                                    –ù–µ—Ç —Ä–∞—Å—Å–∞–¥–∫–∏
                                </div>
                            </div>

                            <div class="tb-card-meta">
                                <span v-if="formatTournamentDate(t)"><i class="mdi mdi-calendar-outline"></i> {{ formatTournamentDate(t) }}</span>
                                <span v-if="getTournamentCity(t)"><i class="mdi mdi-map-marker-outline"></i> {{ getTournamentCity(t) }}</span>
                                <span v-if="getTournamentPlayersCount(t)"><i class="mdi mdi-account-group-outline"></i> {{ getTournamentPlayersCount(t) }}</span>
                                <span v-if="t.id || t.tournamentId" style="opacity:.5;">#{{ t.id || t.tournamentId }}</span>
                            </div>

                            <div v-if="!isTournamentSeatingReady(t)" class="tb-card-no-seating-hint">
                                –†–∞—Å—Å–∞–¥–∫–∞ –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞
                            </div>
                        </div>

                        <button v-if="tournamentsHasMore" class="glass-btn w-full tb-load-more" @click="loadMoreTournaments(); window.haptic.impact('light');" :disabled="tournamentsLoading">
                            <template v-if="tournamentsLoading"><span class="tb-spinner-sm"></span> –ó–∞–≥—Ä—É–∑–∫–∞...</template>
                            <template v-else><i class="mdi mdi-chevron-down"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</template>
                        </button>

                        <div v-if="tournamentsLoading && tournamentsList.length > 0" class="tb-loading-bottom">
                            <span class="tb-spinner-sm"></span>
                        </div>
                    </template>
                </div>

                <button class="glass-btn w-full mt-10" style="opacity: 0.5; font-size: 0.9em;" @click="closeTournamentBrowser(); window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right:8px;"></i>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã –∏ —Å—Ç–æ–ª–∞ -->
        <div v-if="showGameTableModal && !showMainMenu" class="modal">
            <div class="modal-content">
                <h2 style="margin-bottom: 4px;">
                    <i class="mdi mdi-table-furniture" style="margin-right: 8px; color: var(--maf-accent-color, #ae8cff);"></i>
                    –í—ã–±–æ—Ä —Å—Ç–æ–ª–∞
                </h2>
                <div v-if="tournamentName" class="text-secondary" style="font-size: 0.85em; margin-bottom: 16px; text-align: center;">
                    {{ tournamentName }}
                </div>

                <!-- –í—ã–±–æ—Ä –∏–≥—Ä—ã -->
                <div class="selection-card" style="cursor: pointer; background: rgba(255,255,255,0.03); position: relative; overflow: hidden;">
                    <div class="selection-icon">
                        <i class="mdi mdi-gamepad-variant-outline" style="color: #ffd700;"></i>
                    </div>
                    <div class="selection-info" style="flex-grow: 1;">
                        <div style="font-size: 0.75em; color: rgba(255,255,255,0.5); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">–ò–≥—Ä–∞</div>
                        <div style="font-size: 1.2em; font-weight: 700; color: #fff;">–ò–≥—Ä–∞ {{ gameSelected }}</div>
                    </div>
                    <i class="mdi mdi-chevron-down" style="color: rgba(255,255,255,0.4); font-size: 1.4em;"></i>
                    <select
                        v-model.number="gameSelected"
                        @change="onGameSelectChange($event)"
                        style="position: absolute; inset: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; font-size: 16px;">
                        <option v-for="game in games" :value="game.gameNum" style="background: #1a1640; color: #fff;">
                            –ò–≥—Ä–∞ {{ game.gameNum }}
                        </option>
                    </select>
                </div>

                <!-- –í—ã–±–æ—Ä —Å—Ç–æ–ª–∞ -->
                <div v-if="gameSelectedObject && gameSelectedObject.length > 1" class="selection-card mt-10" style="cursor: pointer; background: rgba(255,255,255,0.03); position: relative; overflow: hidden;">
                    <div class="selection-icon">
                        <i class="mdi mdi-table-chair" style="color: var(--maf-accent-color, #ae8cff);"></i>
                    </div>
                    <div class="selection-info" style="flex-grow: 1;">
                        <div style="font-size: 0.75em; color: rgba(255,255,255,0.5); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">–°—Ç–æ–ª</div>
                        <div style="font-size: 1.2em; font-weight: 700; color: #fff;">–°—Ç–æ–ª {{ tableSelected }}</div>
                    </div>
                    <i class="mdi mdi-chevron-down" style="color: rgba(255,255,255,0.4); font-size: 1.4em;"></i>
                    <select
                        v-model.number="tableSelected"
                        style="position: absolute; inset: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; font-size: 16px;">
                        <option v-for="tableEl in gameSelectedObject" :value="Number(tableEl.tableNum)" style="background: #1a1640; color: #fff;">
                            –°—Ç–æ–ª {{ tableEl.tableNum }}
                        </option>
                    </select>
                </div>

                <!-- –ò–Ω—Ñ–æ: –æ–¥–∏–Ω —Å—Ç–æ–ª -->
                <div v-if="gameSelectedObject && gameSelectedObject.length === 1" class="selection-card mt-10" style="cursor: default; background: rgba(255,255,255,0.03); opacity: 0.7;">
                    <div class="selection-icon">
                        <i class="mdi mdi-table-chair" style="color: var(--maf-accent-color, #ae8cff);"></i>
                    </div>
                    <div class="selection-info">
                        <div style="font-weight: 700; font-size: 1em;">–°—Ç–æ–ª {{ gameSelectedObject[0]?.tableNum }}</div>
                        <div style="font-size: 0.8em; color: rgba(255,255,255,0.4);">–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–æ–ª –≤ —ç—Ç–æ–π –∏–≥—Ä–µ</div>
                    </div>
                </div>

                <button class="glass-btn w-full mt-16 btn-primary" @click="confirmGameTable(); window.haptic.impact('medium');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –ù–∞—á–∞—Ç—å
                </button>
                <button class="glass-btn w-full mt-10" style="opacity: 0.5; font-size: 0.9em;" @click="showGameTableModal = false; tournament = undefined; showModal = true; newGameStep = 'gomafia'; window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right: 8px;"></i>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
        <div v-if="showWinnerModal" class="modal">
            <div class="modal-content">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</h2>
                <div class="winner-selection-grid">
                    <div class="winner-card civilians" @click="setWinnerTeam('civilians'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="mdi mdi-account-group"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ü–æ–±–µ–¥–∞ –º–∏—Ä–Ω—ã—Ö</div>
                            <div class="winner-desc">–ö—Ä–∞—Å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</div>
                        </div>
                    </div>

                    <div class="winner-card mafia" @click="setWinnerTeam('mafia'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="mdi mdi-skull"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ü–æ–±–µ–¥–∞ –º–∞—Ñ–∏–∏</div>
                            <div class="winner-desc">–ß–µ—Ä–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</div>
                        </div>
                    </div>

                    <div class="winner-card draw" @click="setWinnerTeam('draw'); window.haptic.notification('success');">
                        <div class="winner-icon">
                            <i class="fa fa-handshake"></i>
                        </div>
                        <div class="winner-info">
                            <div class="winner-title">–ù–∏—á—å—è</div>
                            <div class="winner-desc">–†–∞–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                        </div>
                    </div>
                </div>
                <button class="glass-btn btn-danger mt-16 w-full" @click="showWinnerModal = false; window.haptic.impact('light');">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>

        <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å) -->
        <div v-if="winnerTeam && tableOut?.length" class="scores-list">
            <div class="text-center font-bold text-large mb-20" style="text-shadow: 0 0 15px rgba(255,255,255,0.3);">
                –ü–æ–±–µ–¥–∏–ª–∏: <span :style="{color: winnerTeam === 'civilians' ? '#ff5252' : (winnerTeam === 'mafia' ? '#4fc3f7' : '#fff')}">
                    {{ winnerTeam === 'civilians' ? '–ú–∏—Ä–Ω—ã–µ' : (winnerTeam === 'mafia' ? '–ú–∞—Ñ–∏—è' : '–ù–∏—á—å—è') }}
                </span>
            </div>

            <div v-for="(playerData, index) in tableOut"
                 :key="playerData.roleKey"
                 class="score-card"
                 :class="{ 'highlighted': highlightedPlayer === playerData.roleKey }"
                 @click="toggleHighlight(playerData.roleKey, $event); window.haptic.selection();">

                <div class="player-row-content">
                    <b class="flex-fixed player-num">{{index + 1}}</b>
                    <div class="avatar-uploader flex-fixed">
                        <div class="avatar" :style="{backgroundImage: playerData.avatarCss}"></div>
                    </div>
                    <div class="text-ellipsis player-name">{{playerData.login}}</div>
                    <div class="role-badges-right">
                        <span class="role-tag" :class="playerData.role || 'peace'">
                            {{ getRoleLabel(playerData.role) }}
                        </span>
                        <b style="font-size: 1.2em; margin-left: 10px; min-width: 30px; text-align: right;">{{ calculatePlayerScore(playerData.roleKey) }}</b>
                    </div>
                </div>

                <transition name="slide-fade">
                    <div v-if="highlightedPlayer === playerData.roleKey" class="score-content" @click.stop>
                        <div class="score-dashboard-grid">
                            <!-- –†—è–¥ 1: –ü—Ä–æ—Ç–æ–∫–æ–ª | –ú–Ω–µ–Ω–∏–µ -->
                            <div class="dashboard-cell">
                                <div class="cell-label">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>
                                <div class="info-list">
                                    <div v-if="checkProtocol(playerData.roleKey)">
                                        <div v-for="(res, idx) in checkProtocol(playerData.roleKey)" :key="'prot'+idx" class="info-item">
                                            <span>#{{ idx }}</span>
                                            <div class="flex align-center">
                                                <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                </div>
                            </div>

                            <div class="dashboard-cell">
                                <div class="cell-label">–ú–Ω–µ–Ω–∏–µ</div>
                                <div class="info-list">
                                    <div v-if="checkOpinion(playerData.roleKey)">
                                        <div v-for="(res, idx) in checkOpinion(playerData.roleKey)" :key="'opin'+idx" class="info-item">
                                            <span>#{{ idx }}</span>
                                            <div class="flex align-center">
                                                <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                </div>
                            </div>

                            <!-- –†—è–¥ 2: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –º–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                            <div v-if="getOpinionText(playerData.roleKey)" class="dashboard-cell full-width">
                                <div class="cell-label">–¢–µ–∫—Å—Ç –º–Ω–µ–Ω–∏—è</div>
                                <div class="info-text-mini">
                                    "{{ getOpinionText(playerData.roleKey) }}"
                                </div>
                            </div>

                            <!-- –†—è–¥: –ù–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –î–æ–Ω–∞ / –®–µ—Ä–∏—Ñ–∞) -->
                            <div v-if="(playerData.role === 'don' || playerData.role === 'sheriff') && getNightCheckHistoryFor(playerData.roleKey).length > 0" class="dashboard-cell full-width">
                                <div class="cell-label">
                                    {{ playerData.role === 'don' ? 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ –î–æ–Ω–∞' : 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ –®–µ—Ä–∏—Ñ–∞' }}
                                </div>
                                <div class="info-list">
                                    <div v-for="(check, ci) in getNightCheckHistoryFor(playerData.roleKey)" :key="'nch'+ci" class="info-item">
                                        <span style="color: rgba(255,255,255,0.45);">–ù–æ—á—å {{ check.night }}</span>
                                        <div class="flex align-center">
                                            <span style="margin-right:6px;">‚Üí ‚Ññ{{ check.target }}</span>
                                            <span :style="{ color: check.found ? '#30d158' : '#ff453a', fontWeight: 700 }">{{ check.result }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –†—è–¥ 3: –î–æ–ø | –®—Ç—Ä–∞—Ñ -->
                            <div class="dashboard-cell">
                                <div class="cell-label" style="color:#4caf50;"><i class="fa fa-plus"></i> –î–æ–ø</div>
                                <div class="math-input-container">
                                    <div class="math-input-wrapper">
                                        <button class="math-btn minus" @click="adjustScore(playerData.roleKey, 'bonus', -0.1); window.haptic.impact('light');">-</button>
                                        <input type="number" step="0.1" class="math-input positive"
                                               placeholder="0"
                                               :value="playerScores[playerData.roleKey]?.bonus || ''"
                                               @input="updatePlayerScore(playerData.roleKey, 'bonus', $event.target.value)">
                                        <button class="math-btn plus" @click="adjustScore(playerData.roleKey, 'bonus', 0.1); window.haptic.impact('light');">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="dashboard-cell">
                                <div class="cell-label" style="color:#f44336;"><i class="fa fa-minus"></i> –®—Ç—Ä–∞—Ñ</div>
                                <div class="math-input-container">
                                    <div class="math-input-wrapper">
                                        <button class="math-btn minus" @click="adjustScore(playerData.roleKey, 'penalty', -0.1); window.haptic.impact('light');">-</button>
                                        <input type="number" step="0.1" class="math-input negative"
                                               placeholder="0"
                                               :value="playerScores[playerData.roleKey]?.penalty || ''"
                                               @input="updatePlayerScore(playerData.roleKey, 'penalty', $event.target.value)">
                                        <button class="math-btn plus" @click="adjustScore(playerData.roleKey, 'penalty', 0.1); window.haptic.impact('light');">+</button>
                                    </div>
                                </div>
                            </div>

                            <!-- –†—è–¥ 4: –í—Å–∫—Ä—ã—Ç–∏–µ | –ò—Ç–æ–≥–æ -->
                            <div class="dashboard-cell">
                                <div class="cell-label">–°—Ç–∞—Ç—É—Å</div>
                                <div class="status-content">
                                    <div class="status-row">
                                        <span class="status-text">–í—Å–∫—Ä—ã—Ç–∏–µ</span>
                                        <button class="reveal-btn"
                                                :class="{ 'active': playerScores[playerData.roleKey]?.reveal }"
                                                @click="toggleReveal(playerData.roleKey); window.haptic.impact('light');">
                                            {{ playerScores[playerData.roleKey]?.reveal ? '–î–∞' : '–ù–µ—Ç' }}
                                        </button>
                                    </div>
                                    <div v-if="(playerData.role === 'don' || playerData.role === 'black') && playerData.action === 'killed'" class="self-kill-status">
                                        <i class="mdi mdi-skull" style="margin-right: 6px;"></i> –°–ê–ú–û–°–¢–†–ï–õ
                                    </div>
                                </div>
                            </div>

                            <div class="dashboard-cell" style="background: rgba(var(--maf-accent-color-rgb), 0.05); border-color: rgba(var(--maf-accent-color-rgb), 0.2);">
                                <div class="cell-label" style="color: var(--maf-accent-color);">–ò—Ç–æ–≥–æ</div>
                                <div class="total-content">
                                    <span class="total-value">{{ calculatePlayerScore(playerData.roleKey) }}</span>
                                    <div v-if="(winnerTeam === 'civilians' && (!playerData.role || playerData.role === 'sheriff')) || (winnerTeam === 'mafia' && (playerData.role === 'don' || playerData.role === 'black'))" class="win-badge">
                                        +1 –ü–æ–±–µ–¥–∞
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
            </div>

            <div class="game-actions-row" style="margin-top:20px;">
                <button class="glass-btn funky-back-btn" @click="setWinnerTeam(null); window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right:6px;"></i>
                    <span>–ù–∞–∑–∞–¥</span>
                </button>
                <button class="glass-btn game-finish-btn" @click="funkySaveGameResults(); window.haptic.notification('success');">
                    <i class="mdi mdi-content-save-outline" style="margin-right:6px;"></i>
                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                </button>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∏–≥—Ä–æ–∫–æ–≤ (—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–ª–∏ –∏–¥—ë—Ç —Ä–∞–∑–¥–∞—á–∞ —Ä–æ–ª–µ–π) -->
        <div v-else-if="tableOut?.length && rolesDistributed" class="players-list">
            <!-- Phase label above the table (Discussion / Free Seating) -->
            <div v-if="(gamePhase==='discussion' || gamePhase==='freeSeating') && !winnerTeam" class="phase-label-above-table">
                {{ gamePhase==='discussion' ? '–î–æ–≥–æ–≤–æ—Ä–∫–∞' : '–°–≤–æ–±–æ–¥–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞' }}
            </div>
            <div v-for="(playerData, index) in tableOut"
                 :key="playerData.roleKey"
                 class="player-row"
                 :class="{
                    'highlighted': highlightedPlayer === playerData.roleKey && gamePhase !== 'discussion' && gamePhase !== 'freeSeating',
                    'killed': playerData.action === 'killed',
                    'voted': playerData.action === 'voted',
                    'removed': playerData.action === 'removed',
                    'tech-fall-removed': playerData.action === 'tech_fall_removed',
                    'fall-removed': playerData.action === 'fall_removed',
                    'mode-day': currentMode==='day',
                    'mode-night': currentMode==='night',
                    'mode-old': currentMode==='old',
                    'foul-4': currentMode==='day' && playerData.foul===4,
                    'player-inactive': ['removed','voted','tech_fall_removed','fall_removed'].includes(playerData.action) || (playerData.action==='killed' && protocolAccepted[playerData.roleKey]),
                    'killed-blink': playerData.action==='killed' && !protocolAccepted[playerData.roleKey],
                    'night-don-pulse': currentMode==='night' && nightPhase==='don' && roles[playerData.roleKey]==='don',
                    'night-sheriff-pulse': currentMode==='night' && nightPhase==='sheriff' && roles[playerData.roleKey]==='sheriff'
                 }"
                 :style="{'--i':index}"
                 onclick="void(0)"
                 @click="toggleHighlight(playerData.roleKey, $event); window.haptic.selection();"
            >
                <div class="player-row-content">
                    <b class="flex-fixed player-num">{{index + 1}}</b>
                    <div class="avatar-uploader flex-fixed">
                        <div class="avatar" :style="{backgroundImage: playerData.avatarCss}"></div>
                        <div v-if="avatarExHas(playerData.roleKey)" class="avatar-x" @click.stop="avatarExSet(playerData.roleKey); window.haptic.impact('light');">
                            <i class="fa fa-times"></i>
                        </div>
                        <div class="hovered" @click.stop="avatarExLoad(playerData.roleKey)">
                            <i class="fa fa-camera"></i>
                            <input type="file" accept="image/*" @change="onAvatarExUpload($event, playerData.roleKey)" ref="fileInputs" />
                        </div>
                    </div>
                    <template v-if="manualMode && !funkyMode">
                        <template v-if="manualGameSelected === 1">
                            <input class="input-compact" v-model="manualPlayers[index].login" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞">
                        </template>
                        <template v-else>
                            <select v-model="manualPlayers[index].login" @change="onManualSelectPlayer(index)">
                                <option value="">‚Äî –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ ‚Äî</option>
                                <option v-for="(p, idx) in firstGamePlayers" :value="p.login">{{p.login}}</option>
                            </select>
                        </template>
                    </template>
                    <div v-else class="text-ellipsis player-name">{{playerData.login}}</div>
                    <div class="role-badges-right">
                        <!-- –£–¥–∞–ª—ë–Ω–Ω—ã–π/—É–±–∏—Ç—ã–π –∏–≥—Ä–æ–∫: –∫–Ω–æ–ø–∫–∞ –í–µ—Ä–Ω—É—Ç—å (—Å —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º) -->
                        <template v-if="['removed','killed','voted','tech_fall_removed','fall_removed'].includes(playerData.action)">
                            <span class="day-status-label" v-if="playerData.action==='killed'">–£–±–∏—Ç</span>
                            <span class="day-status-label" v-else-if="playerData.action==='voted'">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                            <span class="day-status-label" v-else-if="playerData.action==='fall_removed'">4 —Ñ–æ–ª–∞</span>
                            <span class="day-status-label" v-else-if="playerData.action==='tech_fall_removed'">2 –¢–§</span>
                            <span class="day-status-label" v-else>–£–¥–∞–ª—ë–Ω</span>
                            <button class="day-return-btn"
                                    @click.stop.prevent
                                    @touchstart.prevent.stop="startDayHold(playerData.roleKey, 'return')"
                                    @touchend.prevent.stop="cancelDayHold()"
                                    @touchcancel.prevent.stop="cancelDayHold()"
                                    @mousedown.prevent.stop="startDayHold(playerData.roleKey, 'return')"
                                    @mouseup.prevent.stop="cancelDayHold()"
                                    @mouseleave.stop="cancelDayHold()">
                                <i class="mdi mdi-heart"></i>
                            </button>
                        </template>
                        <template v-else>
                        <!-- –†–µ–∂–∏–º –î–µ–Ω—å -->
                        <template v-if="currentMode==='day'">
                            <!-- –§–æ–ª: —Ç–∞–ø +1, —É–¥–µ—Ä–∂–∞–Ω–∏–µ -1 -->
                            <button class="day-foul-pill"
                                    :class="{ 'foul-warn': playerData.foul >= 3, 'foul-hot': playerData.foul >= 2 }"
                                    @click.stop.prevent
                                    @touchstart.prevent.stop="startDayHold(playerData.roleKey, 'foul')"
                                    @touchend.prevent.stop="cancelDayHold()"
                                    @touchcancel.prevent.stop="cancelDayHold()"
                                    @mousedown.prevent.stop="startDayHold(playerData.roleKey, 'foul')"
                                    @mouseup.prevent.stop="cancelDayHold()"
                                    @mouseleave.stop="cancelDayHold()">
                                <span class="pill-label">–§</span><span class="pill-count">{{playerData.foul}}</span>
                            </button>
                            <!-- –¢–µ—Ö.—Ñ–æ–ª: —Ç–∞–ø +1, —É–¥–µ—Ä–∂–∞–Ω–∏–µ -1 -->
                            <button class="day-techfoul-pill"
                                    :class="{ 'tf-warn': playerData.techFoul >= 1 }"
                                    @click.stop.prevent
                                    @touchstart.prevent.stop="startDayHold(playerData.roleKey, 'techfoul')"
                                    @touchend.prevent.stop="cancelDayHold()"
                                    @touchcancel.prevent.stop="cancelDayHold()"
                                    @mousedown.prevent.stop="startDayHold(playerData.roleKey, 'techfoul')"
                                    @mouseup.prevent.stop="cancelDayHold()"
                                    @mouseleave.stop="cancelDayHold()">
                                <span class="pill-label">–¢–§</span><span class="pill-count">{{playerData.techFoul}}</span>
                            </button>
                            <!-- –£–¥–∞–ª–∏—Ç—å: —Ç–æ–ª—å–∫–æ —É–¥–µ—Ä–∂–∞–Ω–∏–µ -->
                            <button class="day-remove-btn"
                                    @click.stop.prevent
                                    @touchstart.prevent.stop="startDayHold(playerData.roleKey, 'remove')"
                                    @touchend.prevent.stop="cancelDayHold()"
                                    @touchcancel.prevent.stop="cancelDayHold()"
                                    @mousedown.prevent.stop="startDayHold(playerData.roleKey, 'remove')"
                                    @mouseup.prevent.stop="cancelDayHold()"
                                    @mouseleave.stop="cancelDayHold()">
                                <i class="mdi mdi-account-remove"></i>
                            </button>
                        </template>
                        <!-- –†–µ–∂–∏–º –ù–æ—á—å -->
                        <template v-if="currentMode==='night'">
                            <button class="night-kill-btn" @click.stop="actionSet(playerData.roleKey, 'killed', { nightKill: true }); window.haptic.impact('heavy');" :class="{active: playerData.action==='killed'}">
                                –£–±–∏—Ç—å
                            </button>
                        </template>
                        </template>
                    </div>
                </div>
                <transition name="slide-fade">
                    <div v-if="highlightedPlayer === playerData.roleKey && gamePhase !== 'discussion' && gamePhase !== 'freeSeating'" class="candidate-menu" @click.stop @touchstart.stop>

                        <!-- ============ –ù–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê (–î–æ–Ω / –®–µ—Ä–∏—Ñ) ============ -->
                        <div v-if="currentMode==='night' && (roles[playerData.roleKey]==='don' || roles[playerData.roleKey]==='sheriff')" class="night-check-section">
                            <div class="section-title" style="margin-bottom:8px;">
                                {{ roles[playerData.roleKey]==='don' ? 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–æ–Ω–∞' : 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –®–µ—Ä–∏—Ñ–∞' }}
                            </div>
                            <!-- –ï—Å–ª–∏ –î–æ–Ω/–®–µ—Ä–∏—Ñ —É–±–∏—Ç –Ω–∞ –ü–†–ï–î–´–î–£–©–ò–• –Ω–æ—á–∞—Ö ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                            <div v-if="_wasKilledBeforeThisNight(playerData.roleKey)" class="night-check-dead-msg">
                                <i class="mdi mdi-skull" style="margin-right:6px;"></i>
                                {{ roles[playerData.roleKey]==='don' ? '–î–æ–Ω —É–±–∏—Ç' : '–®–µ—Ä–∏—Ñ —É–±–∏—Ç' }} ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞
                            </div>
                            <template v-else>
                                <div v-if="!nightChecks[playerData.roleKey]" class="night-check-grid">
                                    <button v-for="n in tableOut.length" :key="'nc'+n"
                                            class="night-check-btn"
                                            @click.stop="performNightCheck(playerData.roleKey, n); window.haptic.impact('medium');">
                                        {{ n }}
                                    </button>
                                </div>
                                <div v-else class="night-check-result" :class="{ positive: nightChecks[playerData.roleKey].result.includes('‚úÖ') }">
                                    <div class="night-check-target">–ò–≥—Ä–æ–∫ {{ nightChecks[playerData.roleKey].target }}</div>
                                    <div class="night-check-answer">{{ nightChecks[playerData.roleKey].result }}</div>
                                </div>
                            </template>
                        </div>

                        <!-- ============ –ñ–ò–í–û–ô –ò–ì–†–û–ö: –¢–∞–π–º–µ—Ä + –ö–∞–Ω–¥–∏–¥–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –î–µ–Ω—å) ============ -->
                        <template v-if="playerData.action !== 'killed' && currentMode==='day'">
                            <div class="timer-section">
                                <div class="timer-display" :class="{
                                    running: getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused,
                                    warning: getTimerDisplay(playerData.roleKey).timeLeft <= 10 && getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused
                                }">
                                    {{ Math.floor((gamePhase==='discussion' ? discussionTimeLeft : freeSeatingTimeLeft) / 60).toString().padStart(2, '0') }}:{{ String((gamePhase==='discussion' ? discussionTimeLeft : freeSeatingTimeLeft) % 60).padStart(2, '0') }}
                                </div>
                                <div class="timer-controls">
                                    <button class="timer-btn timer-start"
                                        :disabled="getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused"
                                        @click.stop="handleTimerStart(playerData.roleKey); window.haptic.impact('light');">
                                        <i class="fa fa-play"></i>
                                    </button>
                                    <button class="timer-btn timer-pause"
                                        :disabled="!getTimerDisplay(playerData.roleKey).isRunning || getTimerDisplay(playerData.roleKey).isPaused"
                                        @click.stop="pausePlayerTimer(playerData.roleKey); window.haptic.impact('light');">
                                        <i class="fa fa-pause"></i>
                                    </button>
                                    <button class="timer-btn timer-add"
                                        :class="{ disabled: !isAddTimeButtonAvailable(playerData.roleKey) }"
                                        :disabled="!isAddTimeButtonAvailable(playerData.roleKey)"
                                        @click.stop="addThirtySecondsToTimer(playerData.roleKey); window.haptic.impact('light');">
                                        +30
                                    </button>
                                    <button class="timer-btn timer-stop"
                                        @click.stop="stopPlayerTimer(playerData.roleKey); window.haptic.impact('light');">
                                        <i class="fa fa-stop"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="candidate-grid">
                                <button v-for="n in tableOut.length" :key="'cand'+n"
                                        class="candidate-btn"
                                        :class="candidateButtonClass(playerData.roleKey, n)"
                                        :disabled="isCandidateButtonDisabled(playerData.roleKey, n)"
                                        @click.stop="toggleNomination(playerData.roleKey, n); window.haptic.selection();">
                                    {{ n }}
                                </button>
                            </div>
                            <div v-if="nominations[playerData.roleKey] && nominations[playerData.roleKey].length" class="text-center text-accent font-bold text-large mt-md">
                                –í—ã—Å—Ç–∞–≤–ª–µ–Ω: <span style="font-size:1.18em;">{{ nominations[playerData.roleKey][0] }}</span>
                            </div>
                        </template>

                        <!-- ============ –£–ë–ò–¢–´–ô –ò–ì–†–û–ö: –§–∞–∑–æ–≤—ã–π UI ============ -->
                        <template v-if="playerData.action === 'killed'">

                            <!-- –§–ê–ó–ê: –õ—É—á—à–∏–π —Ö–æ–¥ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —É–±–∏—Ç—ã–π) -->
                            <div v-if="killedCardPhase[playerData.roleKey] === 'bm' && firstKilledPlayer === playerData.roleKey" class="killed-phase-section">
                                <div class="section-title" style="margin-bottom:8px;">üéØ –õ—É—á—à–∏–π —Ö–æ–¥</div>
                                <div class="bm-grid">
                                    <button v-for="n in tableOut.length" :key="'bm2'+n"
                                            class="bm-btn"
                                            :class="{ selected: bestMove.includes(n) }"
                                            :disabled="tableOut[n-1]?.roleKey === firstKilledPlayer"
                                            @click.stop="toggleBestMove(n); window.haptic.selection();">
                                        {{ n }}
                                    </button>
                                </div>
                                <div v-if="bestMove.length" class="text-center text-accent font-bold mt-md" style="font-size:1.1em;">
                                    –õ–•: {{ bestMove.join(', ') }}
                                </div>
                                <button class="killed-hold-btn accept-btn"
                                        @click.stop.prevent
                                        @touchstart.prevent.stop="startBestMoveHold(playerData.roleKey)"
                                        @touchend.prevent.stop="cancelProtocolHold()"
                                        @touchcancel.prevent.stop="cancelProtocolHold()"
                                        @mousedown.prevent.stop="startBestMoveHold(playerData.roleKey)"
                                        @mouseup.prevent.stop="cancelProtocolHold()"
                                        @mouseleave.stop="cancelProtocolHold()">
                                    <i class="fa fa-check" style="margin-right:6px;"></i> –ü—Ä–∏–Ω—è—Ç—å –õ–•
                                    <div class="hold-progress" :class="{ active: dayHoldActive && _dayHoldType === 'accept_bm' }"></div>
                                </button>
                                <div class="hold-hint">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>
                            </div>

                            <!-- –§–ê–ó–ê: –¢–∞–π–º–µ—Ä + –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Ç–æ–∫–æ–ª/–ú–Ω–µ–Ω–∏–µ" -->
                            <div v-if="killedCardPhase[playerData.roleKey] === 'timer'" class="killed-phase-section">
                                <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –õ–• (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —É–±–∏—Ç—ã–π) -->
                                <button v-if="firstKilledPlayer === playerData.roleKey && bestMoveAccepted" class="killed-hold-btn edit-btn"
                                        @click.stop.prevent
                                        @touchstart.prevent.stop="startEditBestMoveHold(playerData.roleKey)"
                                        @touchend.prevent.stop="cancelProtocolHold()"
                                        @touchcancel.prevent.stop="cancelProtocolHold()"
                                        @mousedown.prevent.stop="startEditBestMoveHold(playerData.roleKey)"
                                        @mouseup.prevent.stop="cancelProtocolHold()"
                                        @mouseleave.stop="cancelProtocolHold()">
                                    <i class="fa fa-pencil-alt" style="margin-right:6px;"></i> –ò–∑–º–µ–Ω–∏—Ç—å –õ–•
                                    <div class="hold-progress" :class="{ active: dayHoldActive && _dayHoldType === 'edit_bm' }"></div>
                                </button>

                                <div class="timer-section">
                                    <div class="timer-display" :class="{
                                        running: getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused,
                                        warning: getTimerDisplay(playerData.roleKey).timeLeft <= 10 && getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused
                                    }">
                                        {{ formatTimerTime(getTimerDisplay(playerData.roleKey).timeLeft) }}
                                    </div>
                                    <div class="timer-controls">
                                        <button class="timer-btn timer-start"
                                            :disabled="getTimerDisplay(playerData.roleKey).isRunning && !getTimerDisplay(playerData.roleKey).isPaused"
                                            @click.stop="handleTimerStart(playerData.roleKey); window.haptic.impact('light');">
                                            <i class="fa fa-play"></i>
                                        </button>
                                        <button class="timer-btn timer-pause"
                                            :disabled="!getTimerDisplay(playerData.roleKey).isRunning || getTimerDisplay(playerData.roleKey).isPaused"
                                            @click.stop="pausePlayerTimer(playerData.roleKey); window.haptic.impact('light');">
                                            <i class="fa fa-pause"></i>
                                        </button>
                                        <button class="timer-btn timer-add"
                                            :class="{ disabled: !isAddTimeButtonAvailable(playerData.roleKey) }"
                                            :disabled="!isAddTimeButtonAvailable(playerData.roleKey)"
                                            @click.stop="addThirtySecondsToTimer(playerData.roleKey); window.haptic.impact('light');">
                                            +30
                                        </button>
                                        <button class="timer-btn timer-stop"
                                            @click.stop="stopPlayerTimer(playerData.roleKey); window.haptic.impact('light');">
                                            <i class="fa fa-stop"></i>
                                        </button>
                                    </div>
                                </div>
                                <button class="killed-hold-btn protocol-open-btn" @click.stop="openProtocolForKilled(playerData.roleKey); window.haptic.impact('light');">
                                    <i class="fa fa-file-alt" style="margin-right:6px;"></i> –ü—Ä–æ—Ç–æ–∫–æ–ª / –ú–Ω–µ–Ω–∏–µ
                                </button>
                            </div>

                            <!-- –§–ê–ó–ê: –ü—Ä–æ—Ç–æ–∫–æ–ª –∏ –ú–Ω–µ–Ω–∏–µ -->
                            <div v-if="killedCardPhase[playerData.roleKey] === 'protocol'" class="killed-phase-section">
                                <div class="protocol-section">
                                    <div class="section-title">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>
                                    <div class="protocol-grid">
                                        <button v-for="n in tableOut.length" :key="'prot'+n"
                                                class="protocol-btn"
                                                :class="getProtocolRoleClass(playerData.roleKey, n)"
                                                @click.stop="toggleProtocolRole(playerData.roleKey, n); window.haptic.selection();">
                                            <span class="player-num">{{ n }}</span>
                                            <span class="role-label">{{ getProtocolRoleLabel(playerData.roleKey, n) }}</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="opinion-section">
                                    <div class="section-title">–ú–Ω–µ–Ω–∏–µ</div>
                                    <div class="opinion-grid">
                                        <button v-for="n in tableOut.length" :key="'opin'+n"
                                                class="opinion-btn"
                                                :class="getOpinionRoleClass(playerData.roleKey, n)"
                                                @click.stop="toggleOpinionRole(playerData.roleKey, n); window.haptic.selection();">
                                            <span class="player-num">{{ n }}</span>
                                            <span class="role-label">{{ getOpinionRoleLabel(playerData.roleKey, n) }}</span>
                                        </button>
                                    </div>
                                    <textarea class="opinion-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–Ω–µ–Ω–∏–µ..."
                                        :value="opinionText && opinionText[playerData.roleKey]"
                                        @input="updateOpinionText(playerData.roleKey, $event.target.value)"
                                        @click.stop @touchstart.stop></textarea>
                                </div>
                                <button class="killed-hold-btn accept-btn"
                                        @click.stop.prevent
                                        @touchstart.prevent.stop="startProtocolHold(playerData.roleKey)"
                                        @touchend.prevent.stop="cancelProtocolHold()"
                                        @touchcancel.prevent.stop="cancelProtocolHold()"
                                        @mousedown.prevent.stop="startProtocolHold(playerData.roleKey)"
                                        @mouseup.prevent.stop="cancelProtocolHold()"
                                        @mouseleave.stop="cancelProtocolHold()">
                                    <i class="fa fa-check" style="margin-right:6px;"></i> –ü—Ä–∏–Ω—è—Ç—å –ü—Ä–æ—Ç–æ–∫–æ–ª
                                    <div class="hold-progress" :class="{ active: dayHoldActive && _dayHoldType === 'accept_protocol' }"></div>
                                </button>
                                <div class="hold-hint">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>
                            </div>

                            <!-- –§–ê–ó–ê: –ì–æ—Ç–æ–≤–æ (—Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) -->
                            <div v-if="killedCardPhase[playerData.roleKey] === 'done'" class="killed-phase-section killed-done-phase">
                                <button v-if="firstKilledPlayer === playerData.roleKey" class="killed-hold-btn edit-btn"
                                        @click.stop.prevent
                                        @touchstart.prevent.stop="startEditBestMoveHold(playerData.roleKey)"
                                        @touchend.prevent.stop="cancelProtocolHold()"
                                        @touchcancel.prevent.stop="cancelProtocolHold()"
                                        @mousedown.prevent.stop="startEditBestMoveHold(playerData.roleKey)"
                                        @mouseup.prevent.stop="cancelProtocolHold()"
                                        @mouseleave.stop="cancelProtocolHold()">
                                    <i class="fa fa-pencil-alt" style="margin-right:6px;"></i> –ò–∑–º–µ–Ω–∏—Ç—å –õ–•
                                    <div class="hold-progress" :class="{ active: dayHoldActive && _dayHoldType === 'edit_bm' }"></div>
                                </button>
                                <button class="killed-hold-btn edit-btn"
                                        @click.stop.prevent
                                        @touchstart.prevent.stop="startEditProtocolHold(playerData.roleKey)"
                                        @touchend.prevent.stop="cancelProtocolHold()"
                                        @touchcancel.prevent.stop="cancelProtocolHold()"
                                        @mousedown.prevent.stop="startEditProtocolHold(playerData.roleKey)"
                                        @mouseup.prevent.stop="cancelProtocolHold()"
                                        @mouseleave.stop="cancelProtocolHold()">
                                    <i class="fa fa-pencil-alt" style="margin-right:6px;"></i> –ò–∑–º–µ–Ω–∏—Ç—å –ü—Ä–æ—Ç–æ–∫–æ–ª / –ú–Ω–µ–Ω–∏–µ
                                    <div class="hold-progress" :class="{ active: dayHoldActive && _dayHoldType === 'edit_protocol' }"></div>
                                </button>
                            </div>

                            <!-- Fallback: –µ—Å–ª–∏ —Ñ–∞–∑–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞ -->
                            <div v-if="!killedCardPhase[playerData.roleKey]" class="killed-phase-section">
                                <button class="killed-hold-btn protocol-open-btn" @click.stop="openProtocolForKilled(playerData.roleKey); window.haptic.impact('light');">
                                    <i class="fa fa-file-alt" style="margin-right:6px;"></i> –ü—Ä–æ—Ç–æ–∫–æ–ª / –ú–Ω–µ–Ω–∏–µ
                                </button>
                            </div>

                        </template>
                    </div>
                </transition>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∞ –ü—Ä–æ–º–∞—Ö (–≤–Ω—É—Ç—Ä–∏ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤, –ø–æ–¥ 10 –∏–≥—Ä–æ–∫–æ–º) -->
            <div v-if="currentMode==='night' && !winnerTeam && rolesDistributed && (!nightPhase || nightPhase==='kill') && !nightMisses[nightNumber]"
                 class="player-row night-miss-row"
                 @click.stop="setNightMiss(); window.haptic.notification('warning');">
                <div class="player-row-content night-miss-row-content">
                    <i class="mdi mdi-close-circle-outline night-miss-row-icon"></i>
                    <span class="night-miss-row-label">–ü—Ä–æ–º–∞—Ö</span>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (–ø–æ–¥ —Ç–∞–±–ª–∏—Ü–µ–π –∏–≥—Ä–æ–∫–æ–≤) -->
        <div v-if="tableOut?.length && !winnerTeam && rolesDistributed && gamePhase==='day'" class="voting-btn-container">
            <button class="glass-btn game-voting-btn" @click="openVotingScreen(); window.haptic.impact('medium');">
                <i class="fa fa-gavel" style="margin-right: 8px;"></i>
                –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
            </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏, –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –≤—ã—Ö–æ–¥–∞ -->
        <div class="game-actions-container" v-if="tableOut?.length && rolesDistributed">
            <button class="glass-btn game-broadcast-btn" @click="openBroadcastSettings(); window.haptic.impact('light');">
                <i class="fa fa-sliders-h" style="margin-right: 8px;"></i>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏
            </button>
            <div class="game-actions-row">
                <button v-if="!winnerTeam && (gamePhase==='day' || gamePhase==='night')" class="glass-btn game-finish-btn" @click="showWinnerModal = true; window.haptic.impact('medium');">
                    <i class="fa fa-flag-checkered" style="margin-right: 6px;"></i>
                    <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å</span>
                </button>
                <button class="exit-hold-btn"
                        @touchstart.prevent="startExitHold()"
                        @touchend.prevent="cancelExitHold()"
                        @touchcancel.prevent="cancelExitHold()"
                        @mousedown.prevent="startExitHold()"
                        @mouseup.prevent="cancelExitHold()"
                        @mouseleave="cancelExitHold()">
                    <i class="fa fa-sign-out-alt" style="margin-right: 6px;"></i>
                    <span>–í—ã—Ö–æ–¥</span>
                    <div class="exit-hold-progress" :class="{ active: exitHoldActive }"></div>
                </button>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞) -->
        <div v-if="tableOut?.length && manualMode && !funkyMode && rolesDistributed" class="game-table-panel">
            <div class="flex">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ò–≥—Ä—ã -->
                <div class="game-option-card">
                    <div class="label">–ò–≥—Ä–∞</div>
                    <select
                        v-model.number="manualGameSelected"
                        @change="onGameSelectChange($event)">
                        <option v-for="game in manualGames" :value="game.num">
                            {{game.num}}
                        </option>
                        <option value="new">+ –ù–æ–≤–∞—è</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
        <div v-if="showBroadcastSettings" class="fullscreen-page">
            <div class="fullscreen-page-container">
                <div class="fullscreen-page-header">
                    <button class="fullscreen-back-btn" @click="cancelBroadcastSettings(); window.haptic.impact('light');">
                        <i class="fa fa-arrow-left"></i>
                    </button>
                    <h1 class="fullscreen-page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</h1>
                    <div style="width: 40px;"></div>
                </div>

                <div class="broadcast-settings-body">
                    <div class="broadcast-section-title">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</div>
                    <div class="switches-bottom">
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="mainInfoVisible">
                            <span class="slider"></span>
                            <span>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="additionalInfoVisible">
                            <span class="slider"></span>
                            <span>–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideSeating">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å —Ä–∞—Å—Å–∞–¥–∫—É</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideLeaveOrder">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å –ø–æ—Ä—è–¥–æ–∫ —É—Ö–æ–¥–∞</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideRolesStatus">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å —Ä–æ–ª–∏ –∏ —Å—Ç–∞—Ç—É—Å</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="hideBestMove">
                            <span class="slider"></span>
                            <span>–°–∫—Ä—ã—Ç—å –õ–•</span>
                        </label>
                        <label class="m3e-switch">
                            <input type="checkbox" v-model="showRoomNumber">
                            <span class="slider"></span>
                            <span>–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã</span>
                        </label>
                    </div>

                    <div class="broadcast-section-title" style="margin-top: 24px;">–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</div>
                    <div class="broadcast-room-field">
                        <label class="profile-field-label">–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã</label>
                        <input type="text" inputmode="numeric" pattern="[0-9]*" class="profile-field-input"
                               v-model="roomInput" maxlength="4" placeholder="1234"
                               @input="roomInput = roomInput.replace(/[^0-9]/g, '')">
                        <div class="profile-field-hint">–î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∏–≥—Ä–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∫ roles.html</div>
                    </div>
                </div>

                <button class="glass-btn w-full btn-primary mt-20" @click="saveBroadcastSettings(); window.haptic.notification('success');">
                    <i class="fa fa-check" style="margin-right: 8px;"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
                <button class="glass-btn w-full mt-10" style="opacity: 0.6;" @click="cancelBroadcastSettings(); window.haptic.impact('light');">
                    <i class="fa fa-arrow-left" style="margin-right: 8px;"></i>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- ============ –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê –ì–û–õ–û–°–û–í–ê–ù–ò–Ø ============ -->
        <div v-if="showVotingScreen" class="voting-fullscreen-page">

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –ì–û–õ–û–°–û–í–ê–ù–ò–ï ===== -->
            <div v-if="votingScreenTab === 'voting'" class="voting-screen-content voting-screen-content--no-scroll">

                <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—É—Ä –∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
                <div v-if="!showVotingModal && !hasNominatedCandidates()" class="voting-empty-state">
                    <div class="voting-empty-icon">üó≥Ô∏è</div>
                    <div class="voting-empty-title">–ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç—É—Ä</div>
                    <div class="voting-empty-text">–ù–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∏ –æ–¥–Ω–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç—É—Ä–∞</div>
                    <button class="glass-btn btn-primary voting-empty-night-btn" @click="goToNightFromVoting(); window.haptic.impact('medium');">
                        <i class="mdi mdi-moon-waning-crescent" style="margin-right:8px;"></i>
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ—á—å
                    </button>
                </div>

                <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ: –∞–∫—Ç–∏–≤–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ -->
                <div v-if="showVotingModal" class="voting-active-content voting-active-content--compact">

                    <!-- === –≠–ö–†–ê–ù: –û—Å–Ω–æ–≤–Ω–æ–µ/–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–≤—ã–±–æ—Ä –≥–æ–ª–æ—Å–æ–≤) === -->
                    <template v-if="!votingFinished && !votingTieTimerActive">
                        <!-- –í—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã -->
                        <div class="voting-header-compact">
                            <div class="voting-header-order voting-header-order--large">
                                <span v-for="(candidate, idx) in votingOrder" :key="candidate"
                                      :class="['voting-header-candidate', 'voting-header-candidate--lg', {active: votingCurrentIndex === idx}]">
                                    {{ candidate }}
                                </span>
                            </div>
                        </div>

                        <!-- –í–æ–ø—Ä–æ—Å -->
                        <div class="voting-question-compact">
                            <template v-if="votingStage === 'main' || votingStage === 'tie'">
                                <span v-if="votingStage === 'tie'" class="voting-stage-badge">–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ</span>
                                –ö—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ <b>‚Ññ{{ votingOrder[votingCurrentIndex] }}</b>
                            </template>
                            <template v-else-if="votingStage === 'lift'">
                                –ö—Ç–æ –∑–∞ –ø–æ–¥—ä–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤?
                            </template>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ (main/tie) -->
                        <div v-if="votingStage === 'main' || votingStage === 'tie'" class="voting-keypad">
                            <div class="voting-keypad-row">
                                <button v-for="n in [1,2,3]" :key="'vote'+n" :class="getVotingButtonClass(n)" :disabled="!isVotingButtonEnabled(n)" @click="toggleVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row">
                                <button v-for="n in [4,5,6]" :key="'vote'+n" :class="getVotingButtonClass(n)" :disabled="!isVotingButtonEnabled(n)" @click="toggleVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row">
                                <button v-for="n in [7,8,9]" :key="'vote'+n" :class="getVotingButtonClass(n)" :disabled="!isVotingButtonEnabled(n)" @click="toggleVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row voting-keypad-row--center">
                                <button :class="getVotingButtonClass(10)" :disabled="!isVotingButtonEnabled(10)" @click="toggleVotingSelection(10); window.haptic.selection();">10</button>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ (lift) -->
                        <div v-else-if="votingStage === 'lift'" class="voting-keypad">
                            <div class="voting-keypad-row">
                                <button v-for="n in [1,2,3]" :key="'lift'+n" :class="getLiftVotingButtonClass(n)" :disabled="!isLiftVotingButtonEnabled(n)" @click="toggleLiftVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row">
                                <button v-for="n in [4,5,6]" :key="'lift'+n" :class="getLiftVotingButtonClass(n)" :disabled="!isLiftVotingButtonEnabled(n)" @click="toggleLiftVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row">
                                <button v-for="n in [7,8,9]" :key="'lift'+n" :class="getLiftVotingButtonClass(n)" :disabled="!isLiftVotingButtonEnabled(n)" @click="toggleLiftVotingSelection(n); window.haptic.selection();">{{ n }}</button>
                            </div>
                            <div class="voting-keypad-row voting-keypad-row--center">
                                <button :class="getLiftVotingButtonClass(10)" :disabled="!isLiftVotingButtonEnabled(10)" @click="toggleLiftVotingSelection(10); window.haptic.selection();">10</button>
                            </div>
                        </div>

                        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                        <div v-if="votingNotification" class="text-center font-bold" style="color:var(--status-error);font-size:0.85em;">{{ votingNotification }}</div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π: –ù–∞–∑–∞–¥ + –ü—Ä–∏–Ω—è—Ç—å -->
                        <div class="voting-actions-row">
                            <button v-if="votingCurrentIndex > 0 || votingStage === 'lift'" class="glass-btn voting-action-btn voting-action-btn--secondary" @click="prevVoting(); window.haptic.impact('light');">
                                <i class="fa fa-arrow-left" style="margin-right:6px;"></i> –ù–∞–∑–∞–¥
                            </button>
                            <button class="glass-btn voting-action-btn voting-action-btn--primary" @click="acceptCurrentCandidateVotes(); window.haptic.impact('medium');" :disabled="acceptDisabled">
                                –ü—Ä–∏–Ω—è—Ç—å
                            </button>
                        </div>
                    </template>

                    <!-- === –≠–ö–†–ê–ù: –ù–∏—á—å—è ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ —Å —Ç–∞–π–º–µ—Ä–æ–º === -->
                    <template v-if="votingTieTimerActive && votingTiePlayers.length > 1">
                        <div class="voting-tie-result-screen">
                            <div class="voting-tie-title">‚öñÔ∏è –ù–∏—á—å—è</div>
                            <div class="voting-tie-cards">
                                <div v-for="player in votingTiePlayers" :key="'tie_'+player" class="voting-player-card" :class="{ 'card-active': votingTiePlayers[votingTieTimerPlayerIndex] === player }">
                                    <div class="voting-player-card-num">{{ player }}</div>
                                    <div class="voting-player-card-votes">{{ getVotesForCandidate(player) }} –≥–æ–ª.</div>
                                </div>
                            </div>
                            <!-- –¢–∞–π–º–µ—Ä -->
                            <div class="voting-tie-timer-block">
                                <div class="voting-timer-title-compact">
                                    ‚è± –ò–≥—Ä–æ–∫ ‚Ññ{{ votingTiePlayers[votingTieTimerPlayerIndex] }}
                                </div>
                                <div class="voting-timer-display voting-timer-display--compact" :class="{
                                    'running': votingTieTimerRunning && !votingTieTimerPaused,
                                    'warning': votingTieTimerTimeLeft <= 10 && votingTieTimerRunning && !votingTieTimerPaused
                                }">
                                    {{ formatVotingTimerTime(votingTieTimerTimeLeft) }}
                                </div>
                                <div class="voting-timer-controls">
                                    <button class="timer-btn timer-start" :disabled="votingTieTimerRunning && !votingTieTimerPaused" @click.stop="playVotingTieTimer(); window.haptic.impact('light');">
                                        <i class="fa fa-play"></i>
                                    </button>
                                    <button class="timer-btn timer-pause" :disabled="!votingTieTimerRunning || votingTieTimerPaused" @click.stop="pauseVotingTieTimer(); window.haptic.impact('light');">
                                        <i class="fa fa-pause"></i>
                                    </button>
                                    <button class="timer-btn timer-stop" @click.stop="stopVotingTieTimer(); window.haptic.impact('light');">
                                        <i class="fa fa-stop"></i>
                                    </button>
                                </div>
                                <div v-if="votingTiePlayers.length > 1" class="voting-timer-nav">
                                    <button class="glass-btn" :disabled="votingTieTimerPlayerIndex <= 0" @click.stop="prevVotingTieTimerPlayer(); window.haptic.impact('light');">
                                        ‚óÄ –ü—Ä–µ–¥.
                                    </button>
                                    <span class="voting-timer-player-indicator">
                                        {{ votingTieTimerPlayerIndex + 1 }} / {{ votingTiePlayers.length }}
                                    </span>
                                    <button class="glass-btn" :disabled="votingTieTimerPlayerIndex >= votingTiePlayers.length - 1" @click.stop="nextVotingTieTimerPlayer(); window.haptic.impact('light');">
                                        –°–ª–µ–¥. ‚ñ∂
                                    </button>
                                </div>
                            </div>
                            <button class="glass-btn voting-action-btn voting-action-btn--primary" @click.stop="skipVotingTieTimer(); startTieVoting(); window.haptic.impact('medium');">
                                –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
                            </button>
                        </div>
                    </template>

                    <!-- === –≠–ö–†–ê–ù: –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ / –Ω–æ—á—å === -->
                    <template v-if="votingFinished">
                        <div class="voting-finish-screen">
                            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å —Ç–∞–π–º–µ—Ä–æ–º -->
                            <template v-if="votingWinners && votingWinners.length">
                                <div class="voting-finish-title">–ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã</div>
                                <div class="voting-winner-cards">
                                    <div v-for="winner in votingWinners" :key="'win_'+winner" class="voting-player-card card-voted" :class="{ 'card-active': votingWinners[votingLastSpeechPlayerIndex] === winner }">
                                        <div class="voting-player-card-num">{{ winner }}</div>
                                    </div>
                                </div>
                                <!-- –¢–∞–π–º–µ—Ä –∫—Ä–∞–π–Ω–µ–π —Ä–µ—á–∏ -->
                                <div v-if="votingLastSpeechTimerActive" class="voting-tie-timer-block">
                                    <div class="voting-timer-title-compact">
                                        üé§ –ö—Ä–∞–π–Ω—è—è —Ä–µ—á—å ‚Äî ‚Ññ{{ votingWinners[votingLastSpeechPlayerIndex] }}
                                    </div>
                                    <div class="voting-timer-display voting-timer-display--compact" :class="{
                                        'running': votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused,
                                        'warning': votingLastSpeechTimerTimeLeft <= 10 && votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused
                                    }">
                                        {{ formatVotingTimerTime(votingLastSpeechTimerTimeLeft) }}
                                    </div>
                                    <div class="voting-timer-controls">
                                        <button class="timer-btn timer-start" :disabled="votingLastSpeechTimerRunning && !votingLastSpeechTimerPaused" @click.stop="playVotingLastSpeechTimer(); window.haptic.impact('light');">
                                            <i class="fa fa-play"></i>
                                        </button>
                                        <button class="timer-btn timer-pause" :disabled="!votingLastSpeechTimerRunning || votingLastSpeechTimerPaused" @click.stop="pauseVotingLastSpeechTimer(); window.haptic.impact('light');">
                                            <i class="fa fa-pause"></i>
                                        </button>
                                        <button class="timer-btn timer-stop" @click.stop="stopVotingLastSpeechTimer(); window.haptic.impact('light');">
                                            <i class="fa fa-stop"></i>
                                        </button>
                                    </div>
                                    <div v-if="votingWinners.length > 1" class="voting-timer-nav">
                                        <button class="glass-btn" :disabled="votingLastSpeechPlayerIndex <= 0" @click.stop="prevVotingLastSpeechPlayer(); window.haptic.impact('light');">
                                            ‚óÄ –ü—Ä–µ–¥.
                                        </button>
                                        <span class="voting-timer-player-indicator">
                                            {{ votingLastSpeechPlayerIndex + 1 }} / {{ votingWinners.length }}
                                        </span>
                                        <button class="glass-btn" :disabled="votingLastSpeechPlayerIndex >= votingWinners.length - 1" @click.stop="nextVotingLastSpeechPlayer(); window.haptic.impact('light');">
                                            –°–ª–µ–¥. ‚ñ∂
                                        </button>
                                    </div>
                                </div>
                                <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ—á—å -->
                                <button class="glass-btn voting-action-btn voting-action-btn--primary" @click="finishVotingAndGoToNight(); window.haptic.notification('success');">
                                    <i class="mdi mdi-moon-waning-crescent" style="margin-right:8px;"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ—á—å
                                </button>
                            </template>

                            <!-- –ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ (lift –Ω–µ –ø—Ä–æ—à–µ–ª) ‚Äî –ù–∞—á–∞—Ç—å –Ω–æ—á—å -->
                            <template v-else>
                                <div class="voting-finish-title">–ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏</div>
                                <button class="glass-btn voting-action-btn voting-action-btn--primary" @click="finishVotingNoWinnersAndGoToNight(); window.haptic.notification('warning');">
                                    <i class="mdi mdi-moon-waning-crescent" style="margin-right:8px;"></i> –ù–∞—á–∞—Ç—å –Ω–æ—á—å
                                </button>
                            </template>
                        </div>
                    </template>

                </div>
            </div>

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –ò–°–¢–û–†–ò–Ø ===== -->
            <div v-if="votingScreenTab === 'history'" class="voting-screen-content voting-history-screen">
                <div v-if="votingHistory && votingHistory.length" class="voting-history-container">
                    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–Ω—è–º -->
                    <div class="vh-day-tabs">
                        <button :class="['vh-day-tab', { active: votingHistoryDayFilter === 0 }]"
                                @click="votingHistoryDayFilter = 0; window.haptic.selection();">
                            –í—Å–µ
                        </button>
                        <button v-for="day in getVotingHistoryDays()" :key="'day_' + day"
                                :class="['vh-day-tab', { active: votingHistoryDayFilter === day }]"
                                @click="votingHistoryDayFilter = day; window.haptic.selection();">
                            –î–µ–Ω—å {{ day }}
                        </button>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π -->
                    <div class="vh-list">
                        <div v-for="(voting, vIdx) in getFilteredVotingHistory()" :key="'vh_' + vIdx" class="vh-card">
                            <!-- –®–∞–ø–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                            <div class="vh-card-header">
                                <span class="vh-card-day">–î–µ–Ω—å {{ voting.dayNumber }}</span>
                                <span :class="['vh-card-result-badge', (voting.finalWinners && voting.finalWinners.length) ? 'badge-voted' : 'badge-none']">
                                    <template v-if="voting.finalWinners && voting.finalWinners.length">
                                        –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã: {{ voting.finalWinners.join(', ') }}
                                    </template>
                                    <template v-else>–ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏</template>
                                </span>
                            </div>

                            <!-- –ö–∞–Ω–¥–∏–¥–∞—Ç—ã -->
                            <div v-if="voting.nominees && voting.nominees.length" class="vh-nominees">
                                –ö–∞–Ω–¥–∏–¥–∞—Ç—ã: <b>{{ voting.nominees.join(', ') }}</b>
                            </div>

                            <!-- –≠—Ç–∞–ø—ã -->
                            <div v-for="(stage, sIdx) in voting.stages" :key="'st_' + sIdx" class="vh-stage">
                                <div class="vh-stage-name">
                                    <span v-if="stage.type === 'main'">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                                    <span v-else-if="stage.type === 'tie'">–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ</span>
                                    <span v-else-if="stage.type === 'lift'">–ü–æ–¥—ä–µ–º</span>
                                </div>

                                <!-- main / tie —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                                <template v-if="stage.type !== 'lift'">
                                    <div v-for="candidate in stage.order" :key="'c_' + candidate" class="vh-candidate-row">
                                        <span class="vh-cand-num" :class="{ 'vh-cand-winner': stage.winners && stage.winners.includes(Number(candidate)) }">{{ candidate }}</span>
                                        <span class="vh-cand-votes">{{ stage.results[candidate] ? stage.results[candidate].length : 0 }}</span>
                                        <span class="vh-cand-voters">{{ stage.results[candidate] && stage.results[candidate].length ? stage.results[candidate].join(', ') : '‚Äî' }}</span>
                                    </div>
                                </template>

                                <!-- lift —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                                <template v-else>
                                    <div class="vh-lift-row">
                                        <span class="vh-lift-label">–ó–∞ –ø–æ–¥—ä–µ–º:</span>
                                        <span class="vh-lift-count">{{ stage.liftResults ? stage.liftResults.length : 0 }}</span>
                                        <span class="vh-lift-voters">{{ stage.liftResults && stage.liftResults.length ? stage.liftResults.join(', ') : '‚Äî' }}</span>
                                    </div>
                                    <div class="vh-lift-result" :class="stage.winners && stage.winners.length ? 'lift-pass' : 'lift-fail'">
                                        {{ stage.winners && stage.winners.length ? '‚úì –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã' : '‚úó –û—Å—Ç–∞—é—Ç—Å—è –≤ –∏–≥—Ä–µ' }}
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else class="voting-empty-state">
                    <div class="voting-empty-icon">üìã</div>
                    <div class="voting-empty-title">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>
                    <div class="voting-empty-text">–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ, –∏ –æ–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
            </div>

            <!-- ===== –ù–ò–ñ–ù–ò–ô –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–´–ô –ë–ê–† –ì–û–õ–û–°–û–í–ê–ù–ò–Ø ===== -->
            <div class="voting-bottom-bar">
                <div class="voting-bottom-bar-tabs">
                    <button :class="['game-nav-item', { active: votingScreenTab === 'voting' }]"
                            @click="votingScreenTab = 'voting'; window.haptic.selection();">
                        <i class="fa fa-gavel"></i>
                        <span>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                    </button>
                    <button :class="['game-nav-item', { active: votingScreenTab === 'history' }]"
                            @click="votingScreenTab = 'history'; activeVotingTab = Math.max(0, votingHistory.length - 1); window.haptic.selection();">
                        <i class="fa fa-history"></i>
                        <span>–ò—Å—Ç–æ—Ä–∏—è</span>
                    </button>
                </div>
                <button class="voting-bottom-close-btn" @click="closeVotingScreen(); window.haptic.impact('light');" :disabled="showVotingModal">
                    <i class="fa fa-times"></i>
                    <span>–ó–∞–∫—Ä—ã—Ç—å</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ù–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é -->
    <div v-if="showMainMenu" id="main-nav-bar" class="main-nav-bar">
        <button class="nav-item" :class="{ active: activeHistoryTab === 'active' && !showProfileScreen && !showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = false; activeHistoryTab = 'active'; window.haptic.selection();">
            <i class="mdi mdi-play-circle-outline"></i>
            <span>–ê–∫—Ç–∏–≤–Ω—ã–µ</span>
        </button>
        <button class="nav-item" :class="{ active: activeHistoryTab === 'history' && !showProfileScreen && !showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = false; activeHistoryTab = 'history'; window.haptic.selection();">
            <i class="mdi mdi-history"></i>
            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
        <button class="nav-item nav-item--primary" @click="startNewGame(); window.haptic.impact('medium');">
            <i class="mdi mdi-plus"></i>
            <span>–ù–æ–≤–∞—è</span>
        </button>
        <button class="nav-item" :class="{ active: showThemesScreen }" @click="showProfileScreen = false; showThemesScreen = true; window.haptic.impact('light');">
            <i class="mdi mdi-palette-outline"></i>
            <span>–¢–µ–º—ã</span>
        </button>
        <button class="nav-item" :class="{ active: showProfileScreen }" @click="showThemesScreen = false; showProfileScreen = true; window.haptic.impact('light');">
            <i class="mdi mdi-account-outline"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </div>

    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ (–¥–ª—è –∏–≥—Ä—ã) -->
    <!-- –≠–∫—Ä–∞–Ω —Ä–∞–∑–¥–∞—á–∏ —Ä–æ–ª–µ–π (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–∞, –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–¥–∞—á–∏) -->
    <div v-if="tableOut?.length && !winnerTeam && !rolesDistributed && !showMainMenu && !showModal && !showGameTableModal" class="roles-distribution-overlay">
        <div class="roles-distribution-safe-top"></div>
        <div class="roles-distribution-header">
            <i class="mdi mdi-cards-playing-outline" style="font-size: 1.4em; margin-right: 8px; color: var(--maf-accent-color, #ae8cff);"></i>
            –†–∞–∑–¥–∞—á–∞ —Ä–æ–ª–µ–π
        </div>
        <div class="roles-distribution-hint">–ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞–º. –í—Å–µ –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –º–∏—Ä–Ω—ã–µ.</div>

        <!-- –õ–µ–π–±–ª—ã —Ä–æ–ª–µ–π -->
        <div class="roles-distribution-summary">
            <span class="roles-summary-tag" :class="{ valid: validateRolesDistribution().donCount === 1 }">
                –î–æ–Ω
            </span>
            <span class="roles-summary-tag" :class="{ valid: validateRolesDistribution().blackCount === 2, half: validateRolesDistribution().blackCount === 1 }">
                –ú–∞—Ñ–∏—è
            </span>
            <span class="roles-summary-tag" :class="{ valid: validateRolesDistribution().sheriffCount === 1 }">
                –®–µ—Ä–∏—Ñ
            </span>
        </div>

        <div class="roles-distribution-list">
            <div v-for="(playerData, index) in tableOut"
                 :key="'rd-'+playerData.roleKey"
                 class="roles-distribution-row">
                <b class="flex-fixed player-num">{{index + 1}}</b>
                <div class="avatar-uploader flex-fixed">
                    <div class="avatar" :style="{backgroundImage: playerData.avatarCss}"></div>
                </div>
                <div class="text-ellipsis player-name" style="flex:1;">{{playerData.login}}</div>
                <div class="role-badges-right">
                    <button class="role-button" :class="{ active: playerData.role === 'don' }" @click.stop="roleSet(playerData.roleKey, 'don'); window.haptic.impact('light');" title="–î–æ–Ω">–î</button>
                    <button class="role-button" :class="{ active: playerData.role === 'black' }" @click.stop="roleSet(playerData.roleKey, 'black'); window.haptic.impact('light');" title="–ú–∞—Ñ–∏—è">–ú</button>
                    <button class="role-button" :class="{ active: playerData.role === 'sheriff' }" @click.stop="roleSet(playerData.roleKey, 'sheriff'); window.haptic.impact('light');" title="–®–µ—Ä–∏—Ñ">–®</button>
                </div>
            </div>
        </div>

        <!-- –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
        <div v-if="rolesValidationError" class="roles-validation-error">
            <i class="fa fa-exclamation-triangle" style="margin-right: 6px;"></i>
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª–∏
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º -->
        <div class="roles-save-bar">
            <button class="roles-hold-btn"
                    :class="{ disabled: !validateRolesDistribution().valid }"
                    @touchstart.prevent="startRolesHold()"
                    @touchend.prevent="cancelRolesHold()"
                    @touchcancel.prevent="cancelRolesHold()"
                    @mousedown.prevent="startRolesHold()"
                    @mouseup.prevent="cancelRolesHold()"
                    @mouseleave="cancelRolesHold()">
                <span><i class="fa fa-check" style="margin-right: 8px;"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑–¥–∞—á—É</span>
                <small class="roles-hold-hint-inline">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ</small>
                <div class="roles-hold-progress" :class="{ active: rolesHoldActive }"></div>
            </button>
        </div>
        <div class="roles-distribution-safe-bottom"></div>
    </div>

    <!-- ============ DISCUSSION / FREE SEATING PHASE (unified block) ============ -->
    <div v-if="rolesDistributed && (gamePhase==='discussion' || gamePhase==='freeSeating') && !winnerTeam" id="bottom-bar" class="phase-unified-bar">
        <!-- Timer section -->
        <div class="phase-timer-box">
            <div class="timer-section phase-timer-section">
                <div class="timer-display" :class="{
                    warning: (gamePhase==='discussion' ? discussionTimeLeft : freeSeatingTimeLeft) <= 10 && (gamePhase==='discussion' ? discussionRunning : freeSeatingRunning)
                }">
                    {{ Math.floor((gamePhase==='discussion' ? discussionTimeLeft : freeSeatingTimeLeft) / 60).toString().padStart(2, '0') }}:{{ String((gamePhase==='discussion' ? discussionTimeLeft : freeSeatingTimeLeft) % 60).padStart(2, '0') }}
                </div>
                <div class="timer-controls">
                    <button class="timer-btn timer-start"
                        v-if="gamePhase==='discussion'"
                        :disabled="discussionRunning"
                        @click.stop="startDiscussionTimer(); window.haptic.impact('light');">
                        <i class="fa fa-play"></i>
                    </button>
                    <button class="timer-btn timer-start"
                        v-if="gamePhase==='freeSeating'"
                        :disabled="freeSeatingRunning"
                        @click.stop="startFreeSeatingTimer(); window.haptic.impact('light');">
                        <i class="fa fa-play"></i>
                    </button>
                    <button class="timer-btn timer-pause"
                        v-if="gamePhase==='discussion'"
                        :disabled="!discussionRunning"
                        @click.stop="stopDiscussionTimer(); window.haptic.impact('light');">
                        <i class="fa fa-pause"></i>
                    </button>
                    <button class="timer-btn timer-pause"
                        v-if="gamePhase==='freeSeating'"
                        :disabled="!freeSeatingRunning"
                        @click.stop="stopFreeSeatingTimer(); window.haptic.impact('light');">
                        <i class="fa fa-pause"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Skip phase button -->
        <button class="game-nav-item skip-phase-btn phase-unified-skip-btn"
                @click.stop.prevent
                @touchstart.prevent.stop="gamePhase==='discussion' ? startSkipDiscussionHold() : startSkipFreeSeatingHold()"
                @touchend.prevent.stop="cancelSkipHold()"
                @touchcancel.prevent.stop="cancelSkipHold()"
                @mousedown.prevent.stop="gamePhase==='discussion' ? startSkipDiscussionHold() : startSkipFreeSeatingHold()"
                @mouseup.prevent.stop="cancelSkipHold()"
                @mouseleave.stop="cancelSkipHold()">
            <i class="mdi mdi-skip-forward"></i>
            <span>{{ gamePhase==='discussion' ? '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä–∫—É' : '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—É—é –ø–æ—Å–∞–¥–∫—É' }}</span>
            <div class="skip-hold-progress" :class="{ active: skipHoldActive }"></div>
        </button>
    </div>

    <!-- ============ DAY / NIGHT NAVIGATION ============ -->
    <div v-if="tableOut?.length && !winnerTeam && rolesDistributed && (gamePhase==='day' || gamePhase==='night') && !showVotingScreen" id="bottom-bar" class="game-nav-bar">
        <button class="game-nav-item" :class="{ active: currentMode==='day', 'blink-pulse': dayButtonBlink && currentMode!=='day' }" @click="setMode('day'); window.haptic.selection();">
            <i class="mdi mdi-white-balance-sunny"></i>
            <span>–î–µ–Ω—å {{ dayNumber }}</span>
            <small v-if="getDaySubtitle() && currentMode==='day'" class="nav-subtitle">{{ getDaySubtitle() }}</small>
        </button>
        <button class="game-nav-item" :class="{ active: currentMode==='night' }" @click="setMode('night'); window.haptic.selection();">
            <i class="mdi mdi-moon-waning-crescent"></i>
            <span>–ù–æ—á—å {{ currentMode==='night' ? nightNumber : nightNumber + 1 }}</span>
        </button>
    </div>

    <!-- ============ –ò—Ç–æ–≥–∏ –§–∞–Ω–∫–∏-–≤–µ—á–µ—Ä–∞ ============ -->
    <div v-if="showFunkySummary" class="funky-summary-overlay" style="display:flex; flex-direction:column; height:100vh; height:var(--tg-viewport-height, 100vh);">
        <div class="funky-summary-safe-top"></div>
        <div class="funky-summary-header">
            <i class="mdi mdi-chart-bar" style="font-size: 1.3em; margin-right: 8px; color: var(--maf-accent-color, #ae8cff);"></i>
            –ò—Ç–æ–≥–∏ –≤–µ—á–µ—Ä–∞
        </div>
        <div class="funky-summary-subtitle">{{ funkySummaryTournamentName }}</div>

        <!-- ===== –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ (—Å–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–∞—è –æ–±–ª–∞—Å—Ç—å) ===== -->
        <div style="flex:1; overflow-y:auto; -webkit-overflow-scrolling:touch; padding-bottom:80px;">

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –û–ë–©–ê–Ø ===== -->
            <div v-if="funkySummaryTab === 'overall'">
                <div class="funky-summary-list">
                    <div v-for="(player, rank) in funkySummaryData" :key="'fs-'+player.login"
                         class="score-card"
                         :class="{ 'highlighted': funkySummaryExpanded === player.login }"
                         @click="funkySummaryExpanded = (funkySummaryExpanded === player.login ? null : player.login); window.haptic.selection();">

                        <div class="player-row-content">
                            <b class="flex-fixed player-num" :style="rank < 3 ? {color: ['#ffd700','#c0c0c0','#cd7f32'][rank]} : {}">{{ rank + 1 }}</b>
                            <div class="avatar-uploader flex-fixed">
                                <div class="avatar" :style="player.avatar_link ? {backgroundImage: 'url(' + player.avatar_link + ')'} : {}"></div>
                            </div>
                            <div class="text-ellipsis player-name">{{ player.login }}</div>
                            <div class="role-badges-right">
                                <span class="funky-summary-games-badge">{{ player.games }} {{ player.games === 1 ? '–∏–≥—Ä–∞' : (player.games < 5 ? '–∏–≥—Ä—ã' : '–∏–≥—Ä') }}</span>
                                <b style="font-size: 1.2em; margin-left: 8px; min-width: 36px; text-align: right;">{{ player.totalScore }}</b>
                            </div>
                        </div>

                        <transition name="slide-fade">
                            <div v-if="funkySummaryExpanded === player.login" class="score-content" @click.stop>
                                <div class="score-dashboard-grid">
                                    <div class="dashboard-cell"><div class="cell-label">üéÆ –ò–≥—Ä—ã</div><div class="funky-stat-value">{{ player.games }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üèÜ –ü–æ–±–µ–¥—ã</div><div class="funky-stat-value" style="color:#30d158;">{{ player.wins }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label" style="color:#4caf50;"><i class="fa fa-plus"></i> –î–æ–ø –±–∞–ª–ª—ã</div><div class="funky-stat-value">{{ player.bonusTotal }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label" style="color:#f44336;"><i class="fa fa-minus"></i> –®—Ç—Ä–∞—Ñ—ã</div><div class="funky-stat-value">{{ player.penaltyTotal }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üéØ –ü–£ (–ø–µ—Ä–≤—ã–π —É–±–∏—Ç—ã–π)</div><div class="funky-stat-value">{{ player.firstKilled }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üíÄ –£–±–∏—Ç –Ω–æ—á—å—é</div><div class="funky-stat-value">{{ player.killed }} <span v-if="player.selfKills" style="color:#ff453a; font-size:0.8em;">({{ player.selfKills }} —Å–∞–º.)</span></div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üî¥ –ú–∏—Ä–Ω—ã–π</div><div class="funky-stat-value">{{ player.peacePlayed }} <span class="funky-wins-inline">/ {{ player.peaceWins }} W</span></div></div>
                                    <div class="dashboard-cell"><div class="cell-label">‚ö´ –ú–∞—Ñ–∏—è</div><div class="funky-stat-value">{{ player.mafiaPlayed }} <span class="funky-wins-inline">/ {{ player.mafiaWins }} W</span></div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üé© –î–æ–Ω</div><div class="funky-stat-value">{{ player.donPlayed }} <span class="funky-wins-inline">/ {{ player.donWins }} W</span></div></div>
                                    <div class="dashboard-cell"><div class="cell-label">‚≠ê –®–µ—Ä–∏—Ñ</div><div class="funky-stat-value">{{ player.sheriffPlayed }} <span class="funky-wins-inline">/ {{ player.sheriffWins }} W</span></div></div>
                                    <div class="dashboard-cell"><div class="cell-label">‚ö†Ô∏è –§–æ–ª—ã</div><div class="funky-stat-value">{{ player.foulsTotal }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üîß –¢–µ—Ö. —Ñ–æ–ª—ã</div><div class="funky-stat-value">{{ player.techFoulsTotal }}</div></div>
                                    <div class="dashboard-cell"><div class="cell-label">üö´ –£–¥–∞–ª–µ–Ω–∏—è</div><div class="funky-stat-value">{{ player.removals }}</div></div>
                                    <div class="dashboard-cell" style="background: rgba(var(--maf-accent-color-rgb), 0.05); border-color: rgba(var(--maf-accent-color-rgb), 0.2);">
                                        <div class="cell-label" style="color: var(--maf-accent-color);">–ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤</div>
                                        <div class="funky-stat-value" style="font-size: 1.5em; color: var(--maf-accent-color);">{{ player.totalScore }}</div>
                                    </div>
                                </div>
                            </div>
                        </transition>
                    </div>
                </div>

                <div style="padding: 16px 20px 20px; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <button class="glass-btn funky-shuffle-btn" style="width: 100%; max-width: 400px;"
                            :disabled="funkySummarySharing"
                            @click="funkyShareSummary(); window.haptic.impact('medium');">
                        <template v-if="funkySummarySharing">
                            <i class="mdi mdi-loading mdi-spin" style="margin-right: 6px;"></i>
                            <span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
                        </template>
                        <template v-else-if="funkySummaryShareUrl">
                            <i class="mdi mdi-share-variant-outline" style="margin-right: 6px;"></i>
                            <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –µ—â—ë —Ä–∞–∑</span>
                        </template>
                        <template v-else>
                            <i class="mdi mdi-share-variant-outline" style="margin-right: 6px;"></i>
                            <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
                        </template>
                    </button>
                </div>
            </div>

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –ü–û –ò–ì–†–ê–ú ===== -->
            <div v-if="funkySummaryTab === 'games'">
                <div style="padding: 0 12px;">
                    <div v-for="game in funkySummaryGames" :key="'sg-'+game.gameNumber" class="score-card" style="margin-bottom: 12px;">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–≥—Ä—ã -->
                        <div class="player-row-content" style="cursor:pointer;" @click="funkySummaryGameExpanded = (funkySummaryGameExpanded === game.gameNumber ? null : game.gameNumber); funkySummaryPlayerExpanded = null; window.haptic.selection();">
                            <div style="display:flex; align-items:center; flex:1; gap:10px;">
                                <div style="width:36px; height:36px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:1.1em; flex-shrink:0;"
                                     :style="{background: game.winnerTeam === 'civilians' ? 'rgba(255,82,82,0.15)' : (game.winnerTeam === 'mafia' ? 'rgba(79,195,247,0.15)' : 'rgba(255,255,255,0.08)'), color: game.winnerTeam === 'civilians' ? '#ff5252' : (game.winnerTeam === 'mafia' ? '#4fc3f7' : '#fff')}">
                                    {{ game.gameNumber }}
                                </div>
                                <div>
                                    <div style="font-weight:700; font-size:0.95em;">–ò–≥—Ä–∞ {{ game.gameNumber }}</div>
                                    <div style="font-size:0.8em; color:rgba(255,255,255,0.5);">
                                        –ü–æ–±–µ–¥–∞: <span :style="{color: game.winnerTeam === 'civilians' ? '#ff5252' : (game.winnerTeam === 'mafia' ? '#4fc3f7' : '#fff')}">
                                            {{ game.winnerTeam === 'civilians' ? '–ú–∏—Ä–Ω—ã—Ö' : (game.winnerTeam === 'mafia' ? '–ú–∞—Ñ–∏–∏' : '–ù–∏—á—å—è') }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <i class="mdi" :class="funkySummaryGameExpanded === game.gameNumber ? 'mdi-chevron-up' : 'mdi-chevron-down'" style="font-size:1.4em; color:rgba(255,255,255,0.4);"></i>
                        </div>

                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–æ–π –∏–≥—Ä—ã -->
                        <transition name="slide-fade">
                            <div v-if="funkySummaryGameExpanded === game.gameNumber" style="padding:0;">
                                <!-- –õ—É—á—à–∏–π —Ö–æ–¥ -->
                                <div v-if="game.bestMove && game.bestMove.length" style="padding:8px 16px; background:rgba(0,0,0,0.1); border-top:1px solid rgba(255,255,255,0.06); font-size:0.85em; color:rgba(255,255,255,0.6);">
                                    üéØ –õ—É—á—à–∏–π —Ö–æ–¥: <b style="color:#fff;">{{ game.bestMove.join(', ') }}</b>
                                </div>

                                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
                                <div v-for="p in game.players" :key="'sgp-'+p.roleKey" style="border-top:1px solid rgba(255,255,255,0.06);">
                                    <div class="player-row-content" style="cursor:pointer;" @click.stop="funkySummaryPlayerExpanded = (funkySummaryPlayerExpanded === p.roleKey ? null : p.roleKey); window.haptic.selection();">
                                        <b class="flex-fixed player-num" style="min-width:24px;">{{ p.num }}</b>
                                        <div class="avatar-uploader flex-fixed">
                                            <div class="avatar" :style="p.avatar_link ? {backgroundImage: 'url(' + p.avatar_link + ')'} : {}"></div>
                                        </div>
                                        <div class="text-ellipsis player-name" :style="p.action === 'killed' || p.action === 'voted' || p.action === 'removed' || p.action === 'tech_fall_removed' || p.action === 'fall_removed' ? {opacity:0.5, textDecoration:'line-through'} : {}">{{ p.login }}</div>
                                        <div class="role-badges-right">
                                            <span class="role-tag" :class="getSummaryRoleClass(p.role)">{{ getRoleLabel(p.role) }}</span>
                                            <b style="font-size: 1.1em; margin-left: 8px; min-width: 30px; text-align: right;">{{ p.totalScore }}</b>
                                        </div>
                                    </div>

                                    <!-- –†–∞—Å–∫—Ä—ã—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
                                    <transition name="slide-fade">
                                        <div v-if="funkySummaryPlayerExpanded === p.roleKey" class="score-content" @click.stop>
                                            <div class="score-dashboard-grid">
                                                <!-- –ü—Ä–æ—Ç–æ–∫–æ–ª -->
                                                <div class="dashboard-cell">
                                                    <div class="cell-label">–ü—Ä–æ—Ç–æ–∫–æ–ª</div>
                                                    <div class="info-list">
                                                        <template v-if="p.protocolResults">
                                                            <div v-for="(res, idx) in p.protocolResults" :key="'prt'+idx" class="info-item">
                                                                <span>#{{ idx }}</span>
                                                                <div class="flex align-center">
                                                                    <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                                    <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                                                </div>
                                                            </div>
                                                        </template>
                                                        <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                                    </div>
                                                </div>
                                                <!-- –ú–Ω–µ–Ω–∏–µ -->
                                                <div class="dashboard-cell">
                                                    <div class="cell-label">–ú–Ω–µ–Ω–∏–µ</div>
                                                    <div class="info-list">
                                                        <template v-if="p.opinionResults">
                                                            <div v-for="(res, idx) in p.opinionResults" :key="'opn'+idx" class="info-item">
                                                                <span>#{{ idx }}</span>
                                                                <div class="flex align-center">
                                                                    <span :class="'text-' + res.role" style="margin-right:4px;">{{ getRoleLabel(res.role) }}</span>
                                                                    <i :class="res.correct ? 'fa fa-check check-icon' : 'fa fa-times cross-icon'"></i>
                                                                </div>
                                                            </div>
                                                        </template>
                                                        <div v-else class="empty-data">–ü—É—Å—Ç–æ</div>
                                                    </div>
                                                </div>
                                                <!-- –¢–µ–∫—Å—Ç –º–Ω–µ–Ω–∏—è -->
                                                <div v-if="p.opinionText" class="dashboard-cell full-width">
                                                    <div class="cell-label">–¢–µ–∫—Å—Ç –º–Ω–µ–Ω–∏—è</div>
                                                    <div class="info-text-mini">"{{ p.opinionText }}"</div>
                                                </div>
                                                <!-- –ù–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
                                                <div v-if="p.nightChecks && p.nightChecks.length" class="dashboard-cell full-width">
                                                    <div class="cell-label">{{ p.role === 'don' ? 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ –î–æ–Ω–∞' : 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ –®–µ—Ä–∏—Ñ–∞' }}</div>
                                                    <div class="info-list">
                                                        <div v-for="(check, ci) in p.nightChecks" :key="'nch2'+ci" class="info-item">
                                                            <span style="color: rgba(255,255,255,0.45);">–ù–æ—á—å {{ check.night }}</span>
                                                            <div class="flex align-center">
                                                                <span style="margin-right:6px;">‚Üí ‚Ññ{{ check.target }}</span>
                                                                <span :style="{ color: check.found ? '#30d158' : '#ff453a', fontWeight: 700 }">{{ check.result }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- –î–æ–ø / –®—Ç—Ä–∞—Ñ -->
                                                <div class="dashboard-cell">
                                                    <div class="cell-label" style="color:#4caf50;"><i class="fa fa-plus"></i> –î–æ–ø</div>
                                                    <div class="funky-stat-value">{{ p.bonus }}</div>
                                                </div>
                                                <div class="dashboard-cell">
                                                    <div class="cell-label" style="color:#f44336;"><i class="fa fa-minus"></i> –®—Ç—Ä–∞—Ñ</div>
                                                    <div class="funky-stat-value">{{ p.penalty }}</div>
                                                </div>
                                                <!-- –°—Ç–∞—Ç—É—Å / –ò—Ç–æ–≥–æ -->
                                                <div class="dashboard-cell">
                                                    <div class="cell-label">–°—Ç–∞—Ç—É—Å</div>
                                                    <div class="status-content">
                                                        <div class="status-row">
                                                            <span class="status-text">–í—Å–∫—Ä—ã—Ç–∏–µ</span>
                                                            <span :style="{color: p.reveal ? '#30d158' : 'rgba(255,255,255,0.4)', fontWeight:700}">{{ p.reveal ? '–î–∞' : '–ù–µ—Ç' }}</span>
                                                        </div>
                                                        <div v-if="p.isSelfKill" class="self-kill-status">
                                                            <i class="mdi mdi-skull" style="margin-right: 6px;"></i> –°–ê–ú–û–°–¢–†–ï–õ
                                                        </div>
                                                        <div v-if="p.isFirstKilled" style="font-size:0.8em; color:#ffd700; margin-top:4px;">üéØ –ü–µ—Ä–≤—ã–π —É–±–∏—Ç—ã–π</div>
                                                        <div style="font-size:0.8em; margin-top:2px; color:rgba(255,255,255,0.4);">
                                                            –§: {{ p.foul }} ¬∑ –¢–§: {{ p.techFoul }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="dashboard-cell" style="background: rgba(var(--maf-accent-color-rgb), 0.05); border-color: rgba(var(--maf-accent-color-rgb), 0.2);">
                                                    <div class="cell-label" style="color: var(--maf-accent-color);">–ò—Ç–æ–≥–æ</div>
                                                    <div class="total-content">
                                                        <span class="total-value">{{ p.totalScore }}</span>
                                                        <div v-if="p.won" class="win-badge">+1 –ü–æ–±–µ–¥–∞</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </transition>
                                </div>

                                <!-- ===== –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –Ω–æ—á–µ–π ===== -->
                                <div v-if="buildGameNightTimeline(game).length" style="border-top:1px solid rgba(255,255,255,0.08); padding:12px 16px;">
                                    <div style="font-weight:700; font-size:0.85em; margin-bottom:10px; color:rgba(255,255,255,0.6);">
                                        <i class="mdi mdi-moon-waning-crescent" style="margin-right:4px;"></i> –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –Ω–æ—á–µ–π
                                    </div>
                                    <div v-for="nightItem in buildGameNightTimeline(game)" :key="'nt-'+nightItem.night" style="margin-bottom:8px;">
                                        <div style="font-size:0.75em; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:rgba(255,255,255,0.3); margin-bottom:4px;">–ù–æ—á—å {{ nightItem.night }}</div>
                                        <div v-for="(evt, ei) in nightItem.events" :key="'ne-'+ei" class="info-item" style="margin-bottom:3px;">
                                            <span>{{ evt.icon }}</span>
                                            <span style="flex:1; margin-left:8px; font-size:0.85em;">{{ evt.text }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ===== –ò—Å—Ç–æ—Ä–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è ===== -->
                                <div v-if="game.votingHistory && game.votingHistory.length" style="border-top:1px solid rgba(255,255,255,0.08); padding:12px 16px;">
                                    <div style="font-weight:700; font-size:0.85em; margin-bottom:10px; color:rgba(255,255,255,0.6);">
                                        <i class="fa fa-gavel" style="margin-right:6px;"></i> –ò—Å—Ç–æ—Ä–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                                    </div>
                                    <div v-for="(voting, vIdx) in game.votingHistory" :key="'gvh-'+vIdx" class="vh-card" style="margin-bottom:8px;">
                                        <div class="vh-card-header">
                                            <span class="vh-card-day">–î–µ–Ω—å {{ voting.dayNumber || vIdx + 1 }}</span>
                                            <span :class="['vh-card-result-badge', (voting.finalWinners && voting.finalWinners.length) ? 'badge-voted' : 'badge-none']">
                                                <template v-if="voting.finalWinners && voting.finalWinners.length">–ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã: {{ voting.finalWinners.join(', ') }}</template>
                                                <template v-else>–ù–∏–∫–æ–≥–æ –Ω–µ –∑–∞–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏</template>
                                            </span>
                                        </div>
                                        <div v-if="voting.nominees && voting.nominees.length" class="vh-nominees">
                                            –ö–∞–Ω–¥–∏–¥–∞—Ç—ã: <b>{{ voting.nominees.join(', ') }}</b>
                                        </div>
                                        <div v-for="(stage, sIdx) in voting.stages" :key="'gst-'+sIdx" class="vh-stage">
                                            <div class="vh-stage-name">
                                                <span v-if="stage.type === 'main'">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                                                <span v-else-if="stage.type === 'tie'">–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ</span>
                                                <span v-else-if="stage.type === 'lift'">–ü–æ–¥—ä–µ–º</span>
                                            </div>
                                            <template v-if="stage.type !== 'lift'">
                                                <div v-for="candidate in stage.order" :key="'gc-'+candidate" class="vh-candidate-row">
                                                    <span class="vh-cand-num" :class="{ 'vh-cand-winner': stage.winners && stage.winners.includes(Number(candidate)) }">{{ candidate }}</span>
                                                    <span class="vh-cand-votes">{{ stage.results[candidate] ? stage.results[candidate].length : 0 }}</span>
                                                    <span class="vh-cand-voters">{{ stage.results[candidate] && stage.results[candidate].length ? stage.results[candidate].join(', ') : '‚Äî' }}</span>
                                                </div>
                                            </template>
                                            <template v-else>
                                                <div class="vh-lift-row">
                                                    <span class="vh-lift-label">–ó–∞ –ø–æ–¥—ä–µ–º:</span>
                                                    <span class="vh-lift-count">{{ stage.liftResults ? stage.liftResults.length : 0 }}</span>
                                                    <span class="vh-lift-voters">{{ stage.liftResults && stage.liftResults.length ? stage.liftResults.join(', ') : '‚Äî' }}</span>
                                                </div>
                                                <div class="vh-lift-result" :class="stage.winners && stage.winners.length ? 'lift-pass' : 'lift-fail'">
                                                    {{ stage.winners && stage.winners.length ? '‚úì –ó–∞–≥–æ–ª–æ—Å–æ–≤–∞–Ω—ã' : '‚úó –û—Å—Ç–∞—é—Ç—Å—è –≤ –∏–≥—Ä–µ' }}
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </transition>
                    </div>

                    <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
                    <div v-if="!funkySummaryGames || !funkySummaryGames.length" style="text-align:center; padding:40px 20px; color:rgba(255,255,255,0.3);">
                        <div style="font-size:2em; margin-bottom:8px;">üé≤</div>
                        –ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∏–≥—Ä
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== –ù–∏–∂–Ω–∏–π –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∞—Ä –∏—Ç–æ–≥–æ–≤ ===== -->
        <div class="voting-bottom-bar">
            <div class="voting-bottom-bar-tabs">
                <button :class="['game-nav-item', { active: funkySummaryTab === 'overall' }]"
                        @click="funkySummaryTab = 'overall'; window.haptic.selection();">
                    <i class="mdi mdi-podium"></i>
                    <span>–û–±—â–∞—è</span>
                </button>
                <button :class="['game-nav-item', { active: funkySummaryTab === 'games' }]"
                        @click="funkySummaryTab = 'games'; window.haptic.selection();">
                    <i class="mdi mdi-format-list-numbered"></i>
                    <span>–ü–æ –∏–≥—Ä–∞–º</span>
                </button>
            </div>
            <button class="voting-bottom-close-btn" @click="showFunkySummary = false; showMainMenu = true; funkySummaryShareUrl = ''; window.haptic.impact('light');">
                <i class="fa fa-times"></i>
                <span>–ó–∞–∫—Ä—ã—Ç—å</span>
            </button>
        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script>
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö JS —Å cache-busting
[
    './voting.js',
    './timer.js',
    './session-manager.js',
    './app-connector.js',
    './app-data.js',
    './app-sessions.js',
    './app-game-logic.js',
    './app-ui-integration.js',
    './app-core.js',
    './assets/panel-notification.js'
].forEach(function(src) {
    document.write('<script src="' + src + '?v=' + window.__v + '"><\/script>');
});
</script>
<script>
// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ editVotingHistory –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º Vue-–∏–Ω—Å—Ç–∞–Ω—Å–µ
if (window.app && typeof window.app.editVotingHistory === 'undefined') {
    window.app.editVotingHistory = false;
}

if (window.app) {
  // –ó–∞–≥–ª—É—à–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
  window.app.showReturnPlayerModal = function(number, roleKey) {
    console.log('showReturnPlayerModal –æ—Ç–∫–ª—é—á–µ–Ω–æ');
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º
    this.showReturnPlayerModal = false;
  };
  window.app.confirmReturnPlayer = function() {
    console.log('confirmReturnPlayer –æ—Ç–∫–ª—é—á–µ–Ω–æ');
    this.showReturnPlayerModal = false;
  };
}

// –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp && window.app) {
    console.log('–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App');
    // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    window.Telegram.WebApp.ready();
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    window.telegramApp = window.app;
}
</script>
</body>
</html>
